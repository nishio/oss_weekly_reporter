# GitHub レポート: digitaldemocracy2030/kouchou-ai

期間: 2025-04-30T16:21:25.965323+09:00 から 2025-05-07T16:21:25.965323+09:00 まで

## Issues

### 過去7日間に完了されたissue (17件)

### [[FEATURE] #427のVD作成](https://github.com/digitaldemocracy2030/kouchou-ai/issues/436)

**作成者:** UtkNggc  
**作成日:** 2025-05-06T07:48:24Z  
**内容:**

# 背景
<!-- なぜその機能が必要なのか、何が改善されるのか具体的に記入してください -->
#427のデザイン案作成
https://github.com/orgs/digitaldemocracy2030/projects/3/views/1?pane=issue&itemId=109019487&issue=digitaldemocracy2030%7Ckouchou-ai%7C427

# 提案内容
<!-- 実装案やデザイン案があれば記入してください -->
PC・タブレット・SP時の最適な文字数制限VDを作成して提案する。

**コメント:** なし

---

### [セットアップに時間がかかる](https://github.com/digitaldemocracy2030/kouchou-ai/issues/432)

**作成者:** shingo-ohki  
**作成日:** 2025-05-05T07:25:55Z  
**内容:**

>Macでセットアップをしているのですが、セットアップにはどれくらいかかるものでしょうか？
10分以上この画面のままなのですが、順調に進んでる認識で良いのでしょうか？

from #2開発_広聴AI より

![Image](https://github.com/user-attachments/assets/13b6aad6-8667-49ac-8c32-f387565a37af)

**コメント:** なし

---

### [[workflowテスト]client画面の見た目を修正](https://github.com/digitaldemocracy2030/kouchou-ai/issues/424)

**作成者:** nasuka  
**作成日:** 2025-05-03T23:39:22Z  
**内容:**

# 背景
client画面の見た目に問題がある


# 提案内容
client画面のデザインを修正する

**コメント:** なし

---

### [テスト起票 🎨 資料整備](https://github.com/digitaldemocracy2030/kouchou-ai/issues/420)

**作成者:** masatosasano2  
**作成日:** 2025-05-03T12:22:12Z  
**内容:**

フィードバックください！どなたでも大歓迎

**コメント:** なし

---

### [[design]マスターデザインデータの作成](https://github.com/digitaldemocracy2030/kouchou-ai/issues/415)

**作成者:** UtkNggc  
**作成日:** 2025-05-02T07:07:55Z  
**内容:**

UIエンハンスを回すためにマスターデザインデータを作成したい。

### 作成場所
▼Figma Master Design ファイル
https://www.figma.com/design/ZImSumdtUme9loVY5CejWX/%F0%9F%91%91-Master-Design?node-id=0-1&t=CKUZaubo7v22Lrbc-1

### 具体的には
「管理画面」と「レポート表示画面」のUI。
デフォルト時や入力時、0件時、MAX時、エラー時、などのstateも洗い出してそれぞれ作成。

### 必要なもの
いただいたこちらの環境で見れる画面から作成しますが、
https://kouchou-ai.dd2030.org/
state別や、管理画面などをデザイナーが見れるようにリクエストさせていただきます！

### 予定している手法
①既存画面を利用して大まかにFigmaデータ化（Figmaプラグイン & AI を利用予定）
②Figmaの知見のあるデザイナーが整えていく（AutoLayoutなども）

### NEXT STEP
マスターデザインデータがあれば、UIエンハンスが開始でき、デザインシステム構築にも着手できる。

**コメント:** なし

---

### [Github Actions x LLM で Issueに自動でラベルを貼りたい](https://github.com/digitaldemocracy2030/kouchou-ai/issues/409)

**作成者:** masatosasano2  
**作成日:** 2025-05-01T12:51:02Z  
**内容:**

# 課題
- 1つのIssueが複数の属性を持ちうるため、タイトルの先頭の[text]や絵文字ではなく、複数指定もフィルタもしやすいラベルを活用したい。
- しかし、ラベルを付与できるのはWrite権限以上を持つユーザーに限られる。
- そのため、ラベルの管理コストがメンテナに集中してしまう。

# 提案
メンテナのコストを減らし、タイムリーなラベル更新を可能にするために、
都知事選で採用されていたようにGithub ActionsとLLMの組み合わせによって
Issueの内容から相応しいラベルを自動判定・自動付与する仕組みがほしい。
参考：
- https://github.com/takahiroanno2024/election2024/blob/main/.github/workflows/issue-review.yml
- https://github.com/takahiroanno2024/election2024/blob/main/.github/scripts/review_issue.py

**コメント:** なし

---

### [[REFACTOR] metadata のオプショナル化](https://github.com/digitaldemocracy2030/kouchou-ai/issues/403)

**作成者:** nanocloudx  
**作成日:** 2025-04-30T11:36:30Z  
**内容:**

# 現在の問題点
レポート作成者について記述する metadata というファイルを用意している
デフォルトとして「テスト環境」という画像を用意しているが、これがそのまま使われてしまっているかもしれない

# 提案内容
値や画像がなければ表示から消してしまい、metadata が指定された場合のみレポート作成者欄を用意してみると良いかもしれない

**コメント:** なし

---

### [[DOCUMENT]クラスタ → グループ への言い換え](https://github.com/digitaldemocracy2030/kouchou-ai/issues/401)

**作成者:** masatosasano2  
**作成日:** 2025-04-30T07:33:54Z  
**内容:**

# 現在の問題点
READMEや管理画面の設定において「クラスタ」「クラスタリング」などの用語が使われているが、伝わらない可能性がある。

# 提案内容
「グループ」「グルーピング」などと言い換える。
補足：[宇多津町の報告資料](https://www.town.utazu.lg.jp/uploaded/attachment/3122.pdf)ではそのように言い換えられていた。

**コメント:** なし

---

### [[FEATURE]CSVアップロード時にコメント列を自動で特定してほしい](https://github.com/digitaldemocracy2030/kouchou-ai/issues/304)

**作成者:** masatosasano2  
**作成日:** 2025-04-13T06:59:09Z  
**内容:**

# 背景
コメント列の指定の一手間を減らしたい

# 提案内容
- コメントの列名が「コメント」「comment」「意見」「要望」「投稿」などであったらデフォルトでその列を指定してほしい
- 候補の列名はハードコードで一定カバーし、マッチしなかったらLLMに一番それっぽいのを選んでほしい
- 列が1つしかなかったらそれをコメント列と判定してほしい
- 数値/日付型でない列が1つしかなかったらそれをコメント列と判定してほしい

**コメント:** なし

---

### [[FEATURE]CSVアップロード時にデフォルトでクラスタ数が設定されてほしい](https://github.com/digitaldemocracy2030/kouchou-ai/issues/303)

**作成者:** masatosasano2  
**作成日:** 2025-04-13T06:58:07Z  
**内容:**

# 背景
クラスタ数の設定の一手間を減らしたい

# 提案内容
- クラスタ数について「この設定にする」を押さないと推奨設定通りにならず、そのことが詳細画面を開かないとわかりにくい
- クラスタ数のデフォルト値より小さい件数のCSVを取り込んだ時、先に進もうとするとアラートが出てくれるのは嬉しいが、それなら最初から推奨設定をセットして欲しい


**コメント:** なし

---

### [[FEATURE]「公開」ボタンを押した時の効果を分かりやすくする](https://github.com/digitaldemocracy2030/kouchou-ai/issues/302)

**作成者:** masatosasano2  
**作成日:** 2025-04-13T06:51:12Z  
**内容:**

# 背景
キャプションが「公開」の状態のボタンを押すと非公開になり、「非公開」の状態のボタンを押すと公開になる。
キャプションの意味は現在の状態であってボタンを押した時に発生するアクションではないので間違ってはいないのだが、
client-adminでもclientでも大抵のボタンのキャプションは押した時のアクションに近いので、やや紛らわしい。

# 提案内容
- 案1：マウスオーバー中のみ「非公開にする」「公開にする」などのヒントを表示する
- 案2：マウスオーバー中のみ逆の状態の見た目にする
- 案3：ボタンからスイッチに変える
- 案4：ボタンからチェックボックスに変える　＊この場合、「非公開にする」チェックの方が自然かも

**コメント:** なし

---

### [[DOCUMENT].envファイルの不可視問題 (Mac Finder)](https://github.com/digitaldemocracy2030/kouchou-ai/issues/291)

**作成者:** nishio  
**作成日:** 2025-04-13T00:51:49Z  
**内容:**

# 現在の問題点
MacのFinderでは .env ファイルがデフォルトで非表示のため、cp example.env .env を実行した後、ファイルを見つけられないユーザーがいる。

「.env見つからない」
「Sampleからコピーしてきたとき、それをVScodeで開こうとするときに見つからない」
「隠しファイルをfinderで開こうとしていた」


# 提案内容

READMEで、FinderではなくVSCodeなどのエディタでプロジェクトフォルダを開いて .env ファイルを編集することを推奨する。「実はFinder経由でどうこうするよりVSCodeでフォルダを開いてしまうほうが良かった」


**コメント:** なし

---

### [[FEATURE]zipでのリリース](https://github.com/digitaldemocracy2030/kouchou-ai/issues/288)

**作成者:** nishio  
**作成日:** 2025-04-13T00:14:59Z  
**内容:**

# 背景
Docker/Gitのインストール障壁 (特に自治体ユーザー)
セキュリティポリシーやITスキル不足により、DockerやGitのインストール自体が大きなハードルとなっている。
「リポジトリ」などのIT専門用語が、非エンジニアのユーザーにとって理解しにくい。

>「自治体関係者の中でのアーリーアダプターたちが試す際に、最初の①リポジトリをクローン」段階で既にかなり大きなハードルになっている。」
「Dockerのインストール、Gitのインストールという部分で既にわけがわからなくなっている。」
>「リポジトリ」概念を避けて行政に納品する際は、zip圧縮などをしたりします。
> 「非エンジニアユーザー向けに、GitをインストールせずにZIPダウンロードで運用のほうがよい？(たねのぶ)」

# 解決策

zipでリリースすればgit cloneの部分の解説は必要なくなる


**コメント:** なし

---

### [（アルゴリズム検証） 広聴AIで出力したクラスタのタイトルが抽象的になる問題の解決](https://github.com/digitaldemocracy2030/kouchou-ai/issues/269)

**作成者:** nasuka  
**作成日:** 2025-04-09T06:22:31Z  
**内容:**

# 背景
広聴AIで出力した第一階層のクラスタタイトルが、TTTCのタイトルと比べて具体性に欠けるという声がある。
 
衆院選のデータセットでクラスタタイトルを出力した例を以下に記載する。クラスタ数はどちらも15で設定している。
本来はクラスタに属するデータ点との整合性なども含めて議論するのが理想だが、こちらではクラスタの抽象度についてのみ議論する。

### TTTCの出力結果
レポートのURL: https://news.ntv.co.jp/static/shugiinsenkyo2024/closed-1027/index.html

選挙結果への関心と不安
立憲民主党の支持増加と自民党への批判
過半数割れの可能性と連立政権の模索
投票率と市民参加の重要性
候補者の当選とその影響
選挙特番のエンタメ化
国民民主党と立憲民主党の議席増加への注目
議員の落選に対する反応
石破氏の責任問題
政権交代の可能性
地域別支持動向
和歌山2区の選挙結果
選挙結果の誤報や虚偽情報への懸念
れいわ新選組の躍進と支持拡大への関心
出口調査結果への関心と懐疑


### 広聴AIの出力結果

選挙結果と政治倫理に対する多様な反応と期待
地域別選挙動向と多様な反応
選挙に対する多様な関心と報道の影響
選挙参加と投票率に関する多様な視点と期待
選挙における政党の躍進と略称問題に対する多様な反応
衆院選結果に対する多様な反応と政治的期待
選挙における政党批判と有権者の多様な視点
選挙報道とスポーツ中継の視聴体験とメディアの役割
選挙結果の信頼性と世襲政治に対する多様な反応
日本の政治再編と選挙結果の影響
石破政権の持続性と自民党の未来に対する懸念と期待
日本の政治情勢における政党支持の変動とその影響
衆院選後の政治的再編と連立政権の行方
れいわ新選組の議席増加に対する多様な反応と期待
選挙における政権交代と地域政党の影響に関する多様な視点


感覚的だが、TTTCの出力結果が具体的な行動・現象や固有名詞（個人名・政党名等）がクラスタ名に含まれる傾向がある一方で、広聴AIの方は抽象性の高いタイトルがついているケースが多い。
一概にどちらが悪いといえるものはないが、実用性を考えるとTTTC程度の抽象度で記載されている方が有用な場合がある。

なお、o3-miniでも評価したが、同様の評価が記載されている。
https://chatgpt.com/share/67f60d38-43b4-800f-a20f-3836dbfa4518

![Image](https://github.com/user-attachments/assets/00a6bc92-5a48-4237-8da8-72be1dfbc1e5)

このような差分が生まれる要因として、以下が想定される。

* クラスタリングアルゴリズムの違い
  * 広聴AIではk-meansで第二階層のクラスタを形成した後にクラスタをマージして第一階層を形成するが、TTTCではspectral clusteringでクラスタを形成する
* クラスタリング時に用いる埋め込みの次元の違い
    * 広聴AIではUMAP後の2次元でクラスタリングを行っているが、TTTCでは元のembeddingでクラスタリングを行っている
      * 二次元空間上で飛び地ができるのを防ぐために広聴AIではこのような実装となっている
* プロンプトの違い
  * （アルゴリズムの違いに依存する話だが）広聴AIでは、第二階層のクラスタのタイトル・説明と、サンプリングしたクラスタに属するデータのテキストの情報に基づいて第一階層のタイトル・説明を生成している。一方でTTTCでは、下層のクラスタタイトル・説明を用いていない。
    * 下層のクラスタのタイトル・説明を包含するように指示しているため、抽象的なタイトルが生成されている可能性がある。


# 提案内容
プロンプトレベルでの修正と、アルゴリズムレベルでの修正がある。

## プロンプトレベルでの修正
1. デフォルトプロンプトの文言のチューニング・修正
2. プロンプトに入力する情報の修正
    例. 下層のタイトル・説明は含めずに、純粋にデータ点の情報だけ入力して第一階層のタイトル・説明を生成する


## アルゴリズムレベルでの修正
1. 元の埋込を用いてクラスタリングする
2. k-means以外のアルゴリズム（spectral clustering, hdbscan）を採用する


**コメント:** なし

---

### [[FEATURE]レポート一覧のクリック可能範囲を広げる](https://github.com/digitaldemocracy2030/kouchou-ai/issues/207)

**作成者:** nishio  
**作成日:** 2025-03-31T10:28:45Z  
**内容:**

# 背景

<img width="1023" alt="Image" src="https://github.com/user-attachments/assets/01686efb-d5a0-4679-b456-435ca5e978d2" />

レポートを見るためにクリックするところか説明のない灰色の領域だけ
目の前で使ってもらったらどこをクリックしたらいいか戸惑っていた

# 提案内容
<!-- 実装案やデザイン案があれば記入してください -->

ブロック全体に広げた方がいいのではと思った

**コメント:** なし

---

### [[FEATURE] コード以外の貢献も可視化する](https://github.com/digitaldemocracy2030/kouchou-ai/issues/122)

**作成者:** shingo-ohki  
**作成日:** 2025-03-21T22:56:37Z  
**内容:**

プロジェクト固有の話題ではないですが、一旦こちらに

# 背景

現在、GitHub リポジトリへのコードのマージのみがコントリビューションとして可視化されています。しかし、プロジェクトの進行には以下のようなコード以外の重要な貢献もあります。

- Slack やオンラインミーティングでの議論・調整
- PR や Issue に対するレビューコメント・フィードバック
- #デジタル民主主義2030 のハッシュタグをつけた Twitter（X）での発信
- その他、プロジェクトの前進に貢献する活動

これらの貢献も適切に可視化することで、より多くの人が参加しやすくなり、
現在の「手が足りない」問題の解消や「属人化をなくす」ことにつながるのではないかと考えました。

# 提案内容

コード以外の貢献を記録・可視化する仕組みを検討するのはどうでしょうか？ 例えば、以下のような方法が考えられます。

- Slack や Twitter（X）での貢献を記録する仕組み（例: GitHub Actions で定期的に収集）
- コントリビューションログを作成し、定期的にレポートを公開

また、「プロジェクト本体のコードには手を出しづらいけど、このような形なら参加しやすい」という人が貢献しやすくなるという効果も期待できます。

参考: https://chatgpt.com/share/67ddda49-b6b8-800c-96c3-0a02a62b8839

また、いどばた の仕組みを一部流用できる可能性も考えられ、
熟議への参加や政策提案・法案成立へのコントリビューション可視化にもつながるかもしれません。

**コメント:** なし

---

### [[FEATURE]濃いクラスタを表示している際は、クラスタの説明文も濃いクラスタに合わせたい](https://github.com/digitaldemocracy2030/kouchou-ai/issues/24)

**作成者:** nasuka  
**作成日:** 2025-03-06T05:36:37Z  
**内容:**

# 背景
* 現状は濃いクラスタ表示した際も、全体図と同じクラスタの説明文が並んでいる（最上位層のクラスタが並んでいる）
  * 添付画像のように、現状は散布図上のタイトルと下部のタイトルが整合しない
![Image](https://github.com/user-attachments/assets/27fde824-7e69-4c3d-8f0a-475ca265b20d)

# 提案内容
* 「濃いクラスタ」が選択されている場合はそれらの説明文を表示したい
  * フィルタされているクラスタの解説文のみをページ下部に表示する






**コメント:** なし

---

### 過去7日間に作成されたissue (21件)

### [[FEATURE]エンベデッドモデルを選択可能にする](https://github.com/digitaldemocracy2030/kouchou-ai/issues/450)

**作成者:** tokoroten  
**作成日:** 2025-05-07T07:13:48Z  
**内容:**

# 背景
LLMのプロバイダが選択可能になったので、 text-embedding-3-small の決め打ちでは対応できなくなってきている。
SentenseTransformerによるローカル埋め込みもあるので、選択式にしたい。
SentenseTransformerのほうがtext-embedding-3-small よりも性能が高いというレポートがあるので、text-embedding-3-largeを選択可能にしたい

# 提案内容
リストボックスを設置して、そのAIプロバイダーが提供可能な、エンベデッドモデルの一覧を表示するようにする



**コメント:** なし

---

### [[design]#400 #421 に関連したマスター反映 & マスターデザイン作成](https://github.com/digitaldemocracy2030/kouchou-ai/issues/447)

**作成者:** UtkNggc  
**作成日:** 2025-05-07T02:00:20Z  
**内容:**

・421で管理画面のボタン追加があるのでマスターに反映
・そのボタン押下後の画面がないのでマスター作成

https://github.com/digitaldemocracy2030/kouchou-ai/pull/400
https://github.com/digitaldemocracy2030/kouchou-ai/pull/421

**コメント:** なし

---

### [[DOCUMENT] .github/copilot-instructions.md を設置したい。](https://github.com/digitaldemocracy2030/kouchou-ai/issues/445)

**作成者:** tokoroten  
**作成日:** 2025-05-07T01:18:45Z  
**内容:**

# 提案内容
Github Copilot Chatは、まず `.github/copilot-instructions.md` を必ず読み込み、そのうえで動作する。要するにこのファイルがシステムプロンプトとして振る舞う。

https://copilot-instructions.md/

そのため、傾聴AIに適合した、適切な copilot-instructions.md を設置することで、Github Copilot Chatを利用しているユーザの開発者体験を改善したい。

**コメント:** なし

---

### [[GITHUB_ACTIONS] ラベル判定用のプロンプトの改善](https://github.com/digitaldemocracy2030/kouchou-ai/issues/444)

**作成者:** masatosasano2  
**作成日:** 2025-05-06T16:17:00Z  
**内容:**

# 現在の問題点

ラベル判定が不適切なことがある

# 提案内容

以下の方針に従ってプロンプトを変更する
- [ラベルの説明文](https://github.com/digitaldemocracy2030/kouchou-ai/labels)を踏まえ、適宜修正・補足する
- 内容とマッチすれば何でもいいのではなく、解決すべき課題の分類になっているべきであることを明示する
- 明らかにその分類になると確信できない限り付与しない
- 画像は無視する
- 以下のラベルは定義上実装を見ないとわからないので、タイトルのキーワードマッチだけ残してLLM判定候補から外す
    - dependencies, javascript, python

# 検証結果

直近20件について概ね意図通り改善することと、重大な過不足がないことを確認済み
https://docs.google.com/spreadsheets/d/1XqtM7-eEbcjku2OWjHeD9js-1nHtlNXQY2UMM83ziJo

**コメント:** なし

---

### [[design] デザインシステムの設計](https://github.com/digitaldemocracy2030/kouchou-ai/issues/443)

**作成者:** UtkNggc  
**作成日:** 2025-05-06T13:04:56Z  
**内容:**

デザインシステムの組み方を考える。
（実際の構築作業は本Issueには含まれません。）

### 目的
・UIエンハンスの効率化
・UIブレを防いで一貫したUXを担保
・デザイン資産化

### やること
Figmaのvariables、styles、components、を駆使したシステム設計。
chakraUIを使用してるので、そこも踏まえて設計する。←ここが悩みどころ。

### 将来
これをやりたいのです。
https://zenn.dev/ubie_dev/articles/f927aaff02d618

**コメント:** なし

---

### [[FEATURE][design] headerにプロダクト名を表示する](https://github.com/digitaldemocracy2030/kouchou-ai/issues/441)

**作成者:** UtkNggc  
**作成日:** 2025-05-06T11:13:43Z  
**内容:**

# 背景
<!-- なぜその機能が必要なのか、何が改善されるのか具体的に記入してください -->
現在、header左の部分が「デジタル民主主義2030」になっている。
デジタル民主主義2030は、複数プロダクトを含むプロジェクト名なので、
プロダクト内のheaderではプロダクト名を表記したい。

# 提案内容
<!-- 実装案やデザイン案があれば記入してください -->
・メイン「広聴AI」
・サブ「part of project デジタル民主主義2030」
で画像作成しました。こちらに変えていただくのはいかがでしょう。

▼Figma
https://www.figma.com/design/ZImSumdtUme9loVY5CejWX/%E5%BA%83%E8%81%B4AI%EF%BC%88%E3%83%87%E3%82%B8%E6%B0%912030%EF%BC%89?node-id=176-458&t=PgvCDEqVEw2sn016-11

■設計意図
・ロゴ制作するには時間がかかるので、現時点では取り急ぎフラットなフォントで作成。
・現在のロゴサイズと同じサイズで作成したので、画像のリンク先を変えていただくだけで実装完了いただける見込み。

# ご相談したいこと
「part of project」がしっくりきてない気がする。。もっとふさわしいものがないか。

![Image](https://github.com/user-attachments/assets/9df3d50f-5945-4f6b-a2c7-f4b582b4151e)

**コメント:** なし

---

### [[FEATURE][design] コンテンツ下部のAbout情報をFooterにまとめる](https://github.com/digitaldemocracy2030/kouchou-ai/issues/438)

**作成者:** UtkNggc  
**作成日:** 2025-05-06T09:36:29Z  
**内容:**

# 背景
<!-- なぜその機能が必要なのか、何が改善されるのか具体的に記入してください -->
コンテンツエリア内はその画面独自のコンテンツのみにしたい。
About情報はプロジェクト情報なので、footerにまとめるのが適切。

# 提案内容
<!-- 実装案やデザイン案があれば記入してください -->
Aboutの内容とFooterの内容を組み合わせたfooterを作成する。

※具体的なVDは担当デザイナーが作成します。

**コメント:** なし

---

### [[FEATURE][design]見出し文言変更](https://github.com/digitaldemocracy2030/kouchou-ai/issues/437)

**作成者:** UtkNggc  
**作成日:** 2025-05-06T09:29:26Z  
**内容:**

# 背景
<!-- なぜその機能が必要なのか、何が改善されるのか具体的に記入してください -->
①見出しが英語表記されている
「Report」「About」「Admin Dashboard Report」「Analysis」
わかりやすい日本語の見出しにして、ユーザーの認知負荷を下げたい。

②About情報の位置はfooterが適切そう
ページ下部のデジ民を案内するAbout情報は、footer内にあるのが適切だと思いました。
footerにまとめるならここの「About」見出しも不要かなと。
本Issueでは見出しのみ整えて、別Issueでfooter改善したいです！

# 提案内容
<!-- 実装案やデザイン案があれば記入してください -->
①は日本語表記にする
②はトルツメする

▼具体的にはFigmaのVDをご覧ください
https://www.figma.com/design/ZImSumdtUme9loVY5CejWX/%E5%BA%83%E8%81%B4AI%EF%BC%88%E3%83%87%E3%82%B8%E6%B0%912030%EF%BC%89?node-id=166-14&t=kOSSvTCqdQUPUdMZ-11

# ご相談したいこと
「Analysis」を何に訳すのがいいか迷っています。
「分析結果」「分析要約」など？

**コメント:** なし

---

### [[BUG][design]管理画面：スプレッドシートURLのinput欄がスマホ時のみ高さがつぶれてる](https://github.com/digitaldemocracy2030/kouchou-ai/issues/431)

**作成者:** UtkNggc  
**作成日:** 2025-05-05T05:02:04Z  
**内容:**

### 概要

<!-- バグの簡潔な説明をお願いします -->
スマホビューでGoogleスプレッドシートURLのinput欄の高さが潰れている。
![Image](https://github.com/user-attachments/assets/a890fcae-dc5c-4902-8344-b10345d75203)

### 再現手順

1. スマホビュー環境の管理画面を開く
2. 入力データのスイッチをGoogleスプレッドシートにする

### 期待する動作

<!-- 本来どう動作すべきかを記入してください -->
PC・タブレットビューの時と同じようにしてほしい
![Image](https://github.com/user-attachments/assets/f7c89a70-d7bc-472a-9f43-ba9e065c1924)

よろしくお願いします！！

**コメント:** なし

---

### [[FEATURE] ローカルLLMを簡単に動かすために、OllamaのDockerを追加する](https://github.com/digitaldemocracy2030/kouchou-ai/issues/430)

**作成者:** tokoroten  
**作成日:** 2025-05-05T04:33:13Z  
**内容:**

# 背景
#422 でローカルLLMが実装された（まだレビュー中）
しかし、ollamaやLM Studioを手動でインストールしないと、ローカルLLMを利用することができない

# 提案内容
- OllamaのDockerイメージを追加し、オプションで起動可能にする
- デフォルトで適切なモデルを起動時にロードするようにしておく

公式イメージ
https://hub.docker.com/r/ollama/ollama

いい感じの起動スクリプトを組む


**コメント:** なし

---

### [[FEATURE]レポート一覧画面：レポート0件時のエンプティ表現をする](https://github.com/digitaldemocracy2030/kouchou-ai/issues/428)

**作成者:** UtkNggc  
**作成日:** 2025-05-04T17:07:41Z  
**内容:**

# 現状
エンジニアさんに調べていただいたところ、
・管理画面（client-admin）では「レポートがありません」が表示される
・ユーザー向け（client）の一覧画面では何も表示されない
<img width="1471" alt="Image" src="https://github.com/user-attachments/assets/dc103f60-8421-4079-b7a3-e09e1887195a" />
<img width="1477" alt="Image" src="https://github.com/user-attachments/assets/f0eeed4d-3dad-4816-ac18-f6d40dc48353" />

# 背景
<!-- なぜその機能が必要なのか、何が改善されるのか具体的に記入してください -->
エンプティには
・現状を知らせる（ユーザーを迷子にしない）
・次のアクションの誘導（行動促進）
・プロダクトに対する信頼獲得
などの役割があります。

# 提案内容
<!-- 実装案やデザイン案があれば記入してください -->
具体的にはデザイン時に検討したいですが、少なくとも、
・現状を伝える
・エンプティを解消するために何をしたらいいかを伝える
を満たすUIにはしたい。

# 担当デザイナーへ
かけられる開発工数や、ここに到達するユーザーの背景次第で、どれだけリッチにするかが変わります。
なのでそれを踏まえたうえで、
・文字のみ
・文字 + イメージイラスト
・参照できるものがあればそこへのリンク
・ユーザーにとっては使い方の学習の機会にもなるかもしれないため、その観点でデザインにできることがないか
などを検討していただけるといいかも。

**コメント:** なし

---

### [[FEATURE]レポート一覧画面：レポートタイトルと本文に文字数制限](https://github.com/digitaldemocracy2030/kouchou-ai/issues/427)

**作成者:** UtkNggc  
**作成日:** 2025-05-04T16:51:40Z  
**内容:**

# 背景
<!-- なぜその機能が必要なのか、何が改善されるのか具体的に記入してください -->

<img width="677" alt="Image" src="https://github.com/user-attachments/assets/197f3a31-0800-4956-a94c-929b335e9020" />

本画面は一覧の役割をもつページである。
長いテキストが流し込まれた時にそれが全部表示されると一覧性が阻害されてしまうため、ある程度で文字をカットしたい。

# 提案内容
<!-- 実装案やデザイン案があれば記入してください -->
▼以下の議論をしたうえで、
①制限が必要かどうか（もしかしたら何か意図があって制限してないのかも説）
②どう制限するか（文字数や行数など）

２で確定した仕様でデザイン調整したいです。
ちなみにデザイン観点では行数で制限した方がスマートですがwantくらいの温度感です。

**コメント:** なし

---

### [[GITHUB ACTIONS] 開発状況に応じてProjectsのstatusを自動更新する](https://github.com/digitaldemocracy2030/kouchou-ai/issues/425)

**作成者:** masatosasano2  
**作成日:** 2025-05-04T04:31:06Z  
**内容:**

以下の3パターンの更新を自動化したい

| 元のstatus  | きっかけ | 変更後のstatus |
| ------------- | ------------- | ------------- |
| No Status, Cold List, Need Refinement  | Assign | Ready |
| Ready (and assigned)  | Create PR, comment | In Progress |
| In Progress | Unassigned | Ready |

**コメント:** なし

---

### [コードレビューの効率化](https://github.com/digitaldemocracy2030/kouchou-ai/issues/417)

**作成者:** shingo-ohki  
**作成日:** 2025-05-02T08:08:24Z  
**内容:**

# 背景
Devin の活用が進むに伴い、開発のボトルネックが PR レビューに移りつつある

# 対応策の案

> Shingo OHKI
>   12:00
> 次なるボトルネックはPRレビュー（嬉しい悲鳴） （編集済み） 
> Screenshot from 2025-05-02 11-54-20.png
> NISHIO Hirokazu
>   [12:43](https://w1740803485-clv347541.slack.com/archives/C08FL58M3D3/p1746157384711949)
> Devinに辛口レビューさせよう()
> haruki shimizu
> これ、レビューはお金かかってしまうのですが、サマリーは無料だそうです
> https://www.coderabbit.ai/
> coderabbit.aicoderabbit.ai
> AI Code Reviews | CodeRabbit | Try for Free
> Most advanced AI code reviews that catches 95%+ bugs. Free your devs to ship code faster. (139 kB)
> https://www.coderabbit.ai/
> TakateTomoki
>   13:28
> コードラビット、パプリックリポジトリならレビューも無料です
> コードラビットからdevinに指摘させて更に書き直させるみたいなことできるはず （編集済み） 

from #雑談 チャンネル
https://w1740803485-clv347541.slack.com/archives/C08FL58M3D3/p1746154812918109

**コメント:** なし

---

### [[design]ブランドコンパス制定](https://github.com/digitaldemocracy2030/kouchou-ai/issues/416)

**作成者:** UtkNggc  
**作成日:** 2025-05-02T07:37:24Z  
**内容:**

UI/UX/ワーディング/トンマナ、などを考える際の意思決定材料を制定したい。

### 作成場所
▼Figma Brand Compass スライドファイル
https://www.figma.com/slides/0B55u8rxDjjjpRJbNUEP0Z/%F0%9F%A7%AD-Brand-Compass?node-id=1-42&t=LFrlwNUh5bLJE7rA-1
スライドにした理由は、外部に広報する際にもリンク渡すだけでいいので便利だから

### 具体的には
・Vision Mission Values
・Brand Personality
・Brand Promise
・Design Principles
・Do & Don't
など。意思決定の材料になりそうなもの。

### 必要なもの
・現時点で固まってる指針（ふわっとでもok）
・先にジョインされてるメンバーさんたちが感じる本プロダクトの特性
・なんとなく共通認識になってるもの
などを、slackを漁ったりヒアリングをしたりして集めたい。
↑このヒアリングに広聴AIを利用したいです！！！（当事者としてUXを体験したい）

### 予定している手法
①上記の必要なものを集める
②集めた内容をもとに各内容に落とし込んで整えていく
③Figmaスライドにまとめる
④共通認識になるように全体に共有

### NEXT STEP
ブランドコンパスがあれば、ロゴ制作も可能です。

**コメント:** なし

---

### [[FEATURE]ローカル文脈埋め込み（エンベデッド）をもっとアピールする](https://github.com/digitaldemocracy2030/kouchou-ai/issues/414)

**作成者:** take365  
**作成日:** 2025-05-02T07:05:58Z  
**内容:**

# 背景
控えめに追加された、ローカル文脈埋め込み（エンベデッド）が実は精度がよいと思われる。
![Image](https://github.com/user-attachments/assets/39c45b76-9cdb-4f8e-9086-23852dbba806)

![Image](https://github.com/user-attachments/assets/dfea0951-55fe-45aa-9993-9c91fb78fc39)

サンプルデータで１６クラスタ
text-embedding-3-small　 シルエットスコア（まとまりのよさ）：4.25
https://take365.github.io/1d161322-8480-4805-bda4-f7f613540ba2/
https://take365.github.io/evaluation/evaluation_1d161322-8480-4805-bda4-f7f613540ba2.pdf

ローカル               シルエットスコア（まとまりのよさ）：4.69
https://take365.github.io/1d161322-8480-4805-bda4-f7f613540ba2/
https://take365.github.io/evaluation/evaluation_f339b806-773d-47ca-a257-7f43c4748da1.pdf

※私の公開画面が壊れ気味なのは無理やりリンク作ったのでゆるしてください


# 提案内容
<!-- 実装案やデザイン案があれば記入してください -->
１．AI詳細設定オプションから１つ格上げして、意見グループ数設定と同じレベルにする
２．控えめな文言からもう少しアピールする。

文言の案
＜課金ふれない＞※要約などLLM部分にくらべエンベディングの費用は低く相対的に微差。
サーバ内で埋め込み処理を行う方式です。意見のグループ化や可視化との相性が良く、まとまりのあるクラスタが得られやすい傾向があります（768次元）。
※OpenAIの埋め込みと比較して異なる特性があります。目的に応じてご利用ください。

＜ほどほど＞
APIを使わず、サーバ内で埋め込みを実行します。費用を抑えられるほか、意見のグループ化や可視化において良好な結果が得られるケースもあります（768次元）。
※精度や結果の傾向はモデルにより異なります。用途に応じてお試しください。

＜強気＞
意見の分類・可視化に適した高精度な埋め込みをサーバ内で実行できます。OpenAI APIを使わずに済むため、費用を抑えながらも高い分類性能が期待できます（768次元）。
※OpenAIモデル（1536次元）と比較し、クラスタのまとまりや分離性が良好な場合があります。

**コメント:** なし

---

### [[FEATURE] OpenRouterを使えるようにする](https://github.com/digitaldemocracy2030/kouchou-ai/issues/402)

**作成者:** nasuka  
**作成日:** 2025-04-30T08:55:15Z  
**内容:**

# 背景
* OpenAIが使えないユースケースがある
  * 政治的なキャンペーンでの利用ができない
    * 参考: https://github.com/digitaldemocracy2030/kouchou-ai/issues/255 
  * このため、用途によっては政党が利用できないケースがある
* そもそもOpenAIのみに依存している状況は好ましくないため、使えるLLMの選択肢は増やしたい
* また、OpenAI だと Rate Limit が厳しいという問題もある
  * https://github.com/digitaldemocracy2030/kouchou-ai/issues/295


# 提案内容
* OpenRouterを導入する

# 実装方針案
api
* 環境変数にOpenRouterのAPI Keyをセットできるようにする
* OpenRouterでAPIリクエストを投げられるようにする
  * すべてのモデルをサポートすると厳しそうなので、一旦以下をサポートできると良さそう
    * OpenAI（gpt-4o, 4o-mini）
      * 4.1系列もサポートしても良いかも？
    * Gemini（gemini2.5系列） 
  * 上記のモデルはstructured outputもサポートされているので実装が容易

client-admin
* 環境変数がセットされている場合にOpenRouterのモデルを選択肢に表示する 
  * あわせて、OpenAIのAPIキーがセットされている場合のみ、OpenAIのモデルを選択肢に表示するようにした方が良いかも（今はAPIキーがセットされていなくてもデフォルトで3つの選択肢が表示されている）
    * OpenAI APIキーで使うOpenAIのモデルとOpenRouterで使うOpenAIのモデルは区別できるようにしておいた方が良さそう（リクエストをapiに投げるときにどちらで投げるか判別できるようにするため）
      * e.g. `OpenAI gpt-4o` , `OpenRouter gpt-4o` のような表記にする？
* レポート作成時に選択されたモデルでapiにリクエストを送る
![Image](https://github.com/user-attachments/assets/dda0a3c7-ca57-4709-9c69-933f6eec3628)




**コメント:** なし

---

### [[FEATURE] 環境確認機能を作る](https://github.com/digitaldemocracy2030/kouchou-ai/issues/400)

**作成者:** tokoroten  
**作成日:** 2025-04-30T05:13:14Z  
**内容:**

# 背景
OpenAIのAPIKeyが正しくセットされているのかどうかが、実際にレポートの作成を始めるまで分からない


# 提案内容
管理画面、クライアント画面に以下の機能を付けたい

管理画面
- APIサーバが生きているかどうか
- ~~OpenAIのkeyが正しいか~~ 、疎通できるかどうか（Azureも）
  - API Key の有効性の確認は、https://github.com/digitaldemocracy2030/kouchou-ai/pull/421 で対応済み
  - 以下の検証については未対応
    - 残高不足の確認
    - RateLimitの確認
- クライアント用のフロントサーバが立っているかどうか
- ローカルLLM用のLM Studioが生きているかどうか



**コメント:** なし

---

### [Devin とのうまい協働方法を考える](https://github.com/digitaldemocracy2030/kouchou-ai/issues/398)

**作成者:** shingo-ohki  
**作成日:** 2025-04-30T03:14:27Z  
**内容:**

（広聴AIに限った話ではないですが、一旦ここに）
# 現在の問題点
Devin が活用され始めたが、それによる弊害があるのではないか？
あるとすれば、それを軽減し、人間と Devin のうまい協働方法はないか？

あくまで仮説です

> Shingo OHKI
  今日 11:10
Devin が大活躍してくれるのは嬉しい反面、なんとなく人間がPRを出しにくくなりそうな気がするのですが、これは気のせいですかね。
>Shingo OHKI
  [29分前](https://w1740803485-clv347541.slack.com/archives/C08FL58M3D3/p1745980862512019?thread_ts=1745979009.909629&cid=C08FL58M3D3)
ChatGPT が少し言語化を手伝ってくれました（最初の回答の解決策にはピンと来ていませんが）
https://chatgpt.com/share/68118c77-ca60-800c-9998-987c5fe25f37
「AI導入による文化の摩擦」が起きている自然な状態です。
なるほど、成長痛なんですかね。
気にならない人も多いと思いますし、決して Devin 活用にブレーキを踏みたい訳ではないです（どちらかというと人間が気持ちよく Devin と協働できるうまい活用方法を探したい） （編集済み） 
>ChatGPTChatGPT
[ChatGPT - Devin 活用と参加感](https://chatgpt.com/share/68118c77-ca60-800c-9998-987c5fe25f37)
Shared via ChatGPT (9 kB)
https://chatgpt.com/share/68118c77-ca60-800c-9998-987c5fe25f37
>Shingo OHKI
>3. 「Devinタスクを投げる場所」を整備
[#devin部屋](https://w1740803485-clv347541.slack.com/archives/C08PRQVQWSE) を作ったのは正しそう
>NISHIO Hirokazu
>11:51
>2030年のデジタル民主主義を考える上で、そもそも2030年にはOSS開発の形がだいぶ変わってそう
誰もAIエージェントと一緒にOSS活動をしていくことの知見をもってないので、この場が世界最先端の実験場の一つとして日々いろいろな観測と考察が生まれていくのだと思う

<!-- 現在のコードの何が問題なのか、どのような技術的負債があるかを説明してください -->

# 提案内容
<!-- どのようなリファクタリングを提案するのか、具体的に説明してください -->


**コメント:** なし

---

### [管理画面の基本e2eテスト計画](https://github.com/digitaldemocracy2030/kouchou-ai/issues/396)

**作成者:** devin-ai-integration[bot]  
**作成日:** 2025-04-30T01:43:59Z  
**内容:**

# 管理画面の基本e2eテスト計画

## テストの目的

このテストの目的は、ユーザーが管理画面にアクセスし、CSVファイルをアップロードして新しいレポートを作成するという基本的なワークフローが正常に機能することを確認することです。

## テストの前提条件

1. 管理画面にアクセスするための認証情報が設定されていること
2. テスト用のサンプルCSVファイルが用意されていること
3. APIレスポンスをモックするための設定が完了していること

## テストのステップ

### 1. 管理画面へのアクセスとログイン

- Basic認証を使用して管理画面にアクセス
- 管理画面のトップページが正しく表示されることを確認

### 2. レポート作成ページへの移動

- 「新しいレポートを作成する」ボタンをクリックしてレポート作成ページに移動
- ページタイトル「新しいレポートを作成する」が表示されることを確認

### 3. 基本情報の入力

- レポートIDフィールドに一意のIDを入力（例：`test-report-{timestamp}`）
- 質問フィールドにテスト用の質問を入力（例：「これはテスト質問です」）
- イントロダクションフィールドにテスト用の説明を入力（例：「これはテスト説明です」）

### 4. CSVファイルのアップロード

- CSVファイルタブが選択されていることを確認
- テスト用のサンプルCSVファイルをアップロード
- ファイルが正常にアップロードされ、ファイル名が表示されることを確認
- コメント列が自動的に選択されていることを確認（「comment」列がある場合）

### 5. レポート作成の実行

- 「レポート作成を開始」ボタンをクリックしてフォームを送信
- APIリクエストが正しいパラメータで送信されることを確認（モックAPIを使用）
- 成功メッセージが表示されることを確認
- ダッシュボードページにリダイレクトされることを確認

## モックの設定

テストでは以下のAPIエンドポイントをモックします：

1. レポート作成API（`/admin/reports`）
   - 成功レスポンス：`{ success: true, slug: 'test-report' }`

## テストコードの構造

テストコードは以下の構造で実装します：

```typescript
import { test } from '@playwright/test';
import { CreateReportPage } from '../../pages/admin/create-report';
import { setupBasicAuth } from '../../utils/auth';
import { mockReportCreation } from '../../utils/mock-api';

test.describe('レポート作成ページ', () => {
  test('CSVファイルをアップロードしてレポートを作成する', async ({ page }) => {
    // 認証設定
    await setupBasicAuth(page);
    
    // APIモック設定
    await mockReportCreation(page);
    
    // ページオブジェクトの初期化
    const createReportPage = new CreateReportPage(page);
    
    // レポート作成ページにアクセス
    await createReportPage.goto();
    
    // 基本情報の入力
    await createReportPage.fillBasicInfo(
      'test-report-' + Date.now(),
      'これはテスト質問です',
      'これはテスト説明です'
    );
    
    // CSVファイルのアップロード
    await createReportPage.uploadCsvFile('../../fixtures/sample.csv');
    
    // フォームの送信
    await createReportPage.submitForm();
    
    // リダイレクト先の確認
    await page.waitForURL('**/');
  });
});
```

## 実装上の注意点

1. テストの安定性を確保するため、固定のタイムアウト値ではなく、要素の表示を待つ方法を使用する
2. モックAPIレスポンスは実際のAPIレスポンスと同じ構造にする
3. テスト間の独立性を確保し、テスト順序に依存しないようにする
4. 既存のページオブジェクトとユーティリティを活用して効率的なテストを実装する

## 関連Issue

- #395 管理画面のe2eテスト拡張ケース（APIキーエラーやクレジット不足などのエラーケース）


**コメント:** なし

---

### [管理画面のe2eテスト拡張ケース](https://github.com/digitaldemocracy2030/kouchou-ai/issues/395)

**作成者:** devin-ai-integration[bot]  
**作成日:** 2025-04-30T01:41:40Z  
**内容:**

# 管理画面のe2eテスト拡張ケース

## 追加テストケース

1. Googleスプレッドシートからのデータインポート
   - スプレッドシートURLの入力と取得テスト
   - データ列の選択と表示確認

2. 入力バリデーションのテスト
   - 必須フィールドが空の場合のエラー表示
   - 無効なレポートIDの検証
   - 文字数制限の検証

3. AI詳細設定の変更とその反映
   - モデル選択の変更
   - ワーカー数の調整
   - PubComモードの切り替え
   - プロンプト設定の変更

4. エラーケースのテスト
   - **APIキーが間違っている場合のエラー処理**
   - **クレジットが入っていない場合のエラー処理**
   - ネットワークエラー時の処理
   - サーバーエラー時の処理

## 実装優先度

特に優先度が高いのは:
- APIキーエラーの適切な処理と表示
- クレジット不足時のエラー処理と表示

## 関連ファイル

- `test/e2e/tests/admin/create-report.spec.ts`
- `test/e2e/utils/mock-api.ts`
- `client-admin/app/create/page.tsx`


**コメント:** なし

---

### 過去7日間に更新されたissue（作成・クローズを除く）(27件)

### [[FEATURE]ローカルLLM / embedding を利用できるようにする](https://github.com/digitaldemocracy2030/kouchou-ai/issues/385)

**作成者:** nasuka  
**作成日:** 2025-04-29T03:57:58Z  
**内容:**

# 背景
* 現在はOpenAI/Azure OpenAI のLLMのみをサポートしているが、アカウント登録・契約のハードルがあり、利用できないユーザーがいる
* 特に個人のユーザーではなく、自治体などの組織においては最初のアカウント作成がボトルネックになるケースがある
  * 出力の品質は下がるが、ローカルLLMの出力でもある程度参考になるアウトプットを出せる可能性がある
    * また、どのようなアウトプットが出るのかイメージできると、本格導入の話も進みやすくなる


# 提案内容
* ローカルLLMおよびembeddingを利用できるようにする
  * 事前に実験を行ったうえで、利用するLLM/embeddingを選定する
    * 要件としては、[こちら](https://gist.github.com/nishio/469b5dc420c77b359ef43f3bdfb11526) に記載されているスペックのマシンで動作すると良さそう（メモリ16GB以内）
* UIとしては、管理画面の「AIモデル」のセレクトボックスにローカルLLMのモデル名を追加する 
  * embeddingの選択フォームは現状存在しないので新設する

![Image](https://github.com/user-attachments/assets/f1cbd478-be65-4dfa-93fb-f980e598c39f)

**コメント:** なし

---

### [[FEATURE] 複数の公開リスト](https://github.com/digitaldemocracy2030/kouchou-ai/issues/366)

**作成者:** mtane0412  
**作成日:** 2025-04-23T13:28:58Z  
**内容:**

# 背景

現在作成されたすべてのレポートが単一のリストに追加されるようになっている。
レポートの中には関連して作成されるレポートなどもある。

会議ログの補足で、

> 複数のシリーズレポートのシェアで不便になりそう(aruga)

シリーズレポートに関しては現場で実際に作られているが、リスト機能のニーズを直接確認したわけではないので現状まだ high priority ではない。
公開非公開の議論の中で個別認証時に不便になりそうという意見。


2025/4/23 定例
> レポートの限定公開ステータスの需要が少し気になってます！
> boolから型を変えるので後方互換もあるので、思ったより面倒かもしれないので。
> YouTubeのunlistedみたいなもの
> Clientのトップに単一のリストがあって自動的にそこに入って公開されてしまう(nishio)
> そもそもデフォルトpublicでlistedだったら公開したくないものも作成した瞬間公開されてしまう問題があるのでは
> YouTubeみたいにデフォルトprivateかせめてunlistedじゃないといけないのでは
> 管理画面同様にBASIC認証をかける？(nasuka)
> レポートごとに個別のパスワードを設定できればいいのでは(nishio)
> 複数のシリーズレポートのシェアで不便になりそう(aruga)
> そういう意味ではそもそもリストが複数作れないといけないのでは(nishio)


# 提案内容
リストを複数作成でき、レポートをリストに登録できる

**コメント:** なし

---

### [[FEATURE] レポートがデフォルトで公開されないようにする](https://github.com/digitaldemocracy2030/kouchou-ai/issues/365)

**作成者:** mtane0412  
**作成日:** 2025-04-23T13:24:06Z  
**内容:**

# 背景

> そもそもデフォルトpublicでlistedだったら公開したくないものも作成した瞬間公開されてしまう問題があるのでは

サーバーを公開している状態で、作成直後にpublicとして出力される問題がある。
現在の仕様だと、isPublic = falseなレポートは管理者でも表示ができない。

2025/4/23 定例
> レポートの限定公開ステータスの需要が少し気になってます！
> boolから型を変えるので後方互換もあるので、思ったより面倒かもしれないので。
> YouTubeのunlistedみたいなもの
> Clientのトップに単一のリストがあって自動的にそこに入って公開されてしまう(nishio)
> そもそもデフォルトpublicでlistedだったら公開したくないものも作成した瞬間公開されてしまう問題があるのでは
> YouTubeみたいにデフォルトprivateかせめてunlistedじゃないといけないのでは
> 管理画面同様にBASIC認証をかける？(nasuka)
> レポートごとに個別のパスワードを設定できればいいのでは(nishio)
> 複数のシリーズレポートのシェアで不便になりそう(aruga)
> そういう意味ではそもそもリストが複数作れないといけないのでは(nishio)

# 提案内容
デフォルトで非公開、もしくは限定公開( #341 )のようにアクセスできないようにする。
非公開であっても管理者が作成されたレポートを確認できるようにする。

**コメント:** なし

---

### [(実験) 同一の内容が大量に投稿される問題への対処法](https://github.com/digitaldemocracy2030/kouchou-ai/issues/346)

**作成者:** nasuka  
**作成日:** 2025-04-21T05:54:34Z  
**内容:**

# 背景
https://github.com/digitaldemocracy2030/kouchou-ai/issues/345
上記のIssueに紐づく実験のIssue

以下元Issueの背景を転載
* [パブコメの大量投稿](https://x.com/takahiroanno/status/1914151807443718381) によって、入力データの中に似通った内容が大量に含まれる場合がある
* これによって、以下の問題が起きる
  * 1.フロントの処理負荷が高くなる
    * 現在の設計では、数万件〜規模のデータは描画の負荷が高くPCによっては正常に表示できない可能性がある
  * 2.バックエンドの処理負荷・コストが高くなる
    * レポート出力処理の際のクラスタリングの計算負荷が高くなる・extraction処理にかかるLLM APIのコストが高くなる
  * 3.ユーザーの認知負荷が高くなる
    * 今の形式でクラスタリングや可視化を行うと、スパム的な意見が意見全体の大半を占めるために、本来着目したい意見が目立たなくなってしまう可能性がある


# 提案内容
* 類似する意見をあらかじめまとめたうえで、まとめた後の意見を広聴AIの分析にかける。
  * まとめた後の意見が表示されるようになることで、フロントの処理負荷が下がり、またユーザーの認知負荷も下がる
  クラスタよりもより細かい粒度で、「ほとんど同じことを言っている意見」がまとめられると良さそう？（あくまで一案で、この粒度でまとめるのがマストではない）
* まとめ方には幾つかのアプローチがありそう。
  * e.g. クラスタリングでまとめる、LLMでまとめる、そのハイブリッド等

↑は問題解決の一つのアプローチの案として記載していますが、他にアプローチがあれば随時コメントにご記載ください。

## 想定する進め方
* 実験データの選定（or 作成）
* 実験データに対して、アルゴリズムを適用し、アウトプットを確認
  * * @nishio , @nasuka （+ 時間があれば@takahiroanno も）あたりは確認しておけると良さそう
* 問題なさそうであれば機能実装の検討に移る




**コメント:** なし

---

### [[FEATURE] LLMが出力した結果の手動修正機能がほしい](https://github.com/digitaldemocracy2030/kouchou-ai/issues/310)

**作成者:** nasuka  
**作成日:** 2025-04-15T05:38:53Z  
**内容:**

# 背景
* LLMが出力したクラスタ名や説明、argumentが適切でない場合がある
  * e.g.
    * 公開するのに不適切な単語や表現がクラスタ名に含まれている
    * 他のクラスタと同一の内容がクラスタ名に含まれている
* このようなケースにおいては、LLMのアウトプットを見た後に人間が手動で文言を修正したい

# 提案内容
LLMが出力したテキスト（クラスタタイトル・説明・概要・argument）について、手動で編集する画面をadminに設け、レポートに編集内容を反映する


(admin)
* 上記の編集画面を設ける
  * 編集後のデータを編集用のendpointに送る

(api)
* 編集用のendpointを実装する
  * リクエストで受け取ったデータを各種中間ファイル（args.csv等）に保存
  * hierarchical_aggregation.pyを再度実行し、更新後のデータでhierarchical_result.jsonを保存する

そもそも全要素を編集できるようにするかというのは議論の余地がある。やるとしても、まずはクラスタ名のみを対象にするなど、部分的に始めていくのが良さそう。
また、透明性担保のために編集履歴を残すようにするかも議論の余地がある。

**コメント:** なし

---

### [[FEATURE]「全体図」「濃い意見グループ」のUI/UX改善](https://github.com/digitaldemocracy2030/kouchou-ai/issues/306)

**作成者:** masatosasano2  
**作成日:** 2025-04-13T11:20:06Z  
**内容:**

# 背景

操作しててたまたま以下に気づいたが、見ただけでは分からない。
・範囲指定（ドラッグ）すると拡大できること
・拡大した状態から元の倍率に戻すにはダブルクリックすること

濃い意見グループで上がってきているクラスタが第一階層？のクラスタのどれに属すのかがわからない。

# 提案内容

ズームについて
- ヒントアイコンで操作方法のヒントを表示する
- ズームイン/アウトの操作ボタンを用意する（ドラッグでパンできないので、上下左右の移動ボタンも必要？）
- 表示モードや全画面に切り替えたときに表示がリセットされないように Issue #290 を参考に状態保持を実装する

濃い意見グループについて
- ラベルか色で表現する？

**コメント:** なし

---

### [[FEATURE]ラベルが多い時の重なりの問題](https://github.com/digitaldemocracy2030/kouchou-ai/issues/294)

**作成者:** nishio  
**作成日:** 2025-04-13T00:59:47Z  
**内容:**

## 課題

広聴AIのレポート画面に表示されるプロットグラフにおいて、分析によって生成されたクラスタ（意見グループ）の数が多い場合に、各クラスタを示すラベルが互いに重なり合ってしまい、判読が困難になるという問題があります。

特に、自治体での利用など、詳細な分析のためにクラスタを細かく分ける傾向がある場合に、この見にくさが顕著になります。
> 「自治体的には、クラスタを細かく分ける方向の議論が強い。」
> 「UIの観点で、プロットグラフがそれに対応していけるとよさそう。」
> 「ラベルは重なって見にくくならないようにできるとか」

現状のままでは、せっかく詳細に分類された意見グループの内容を、グラフ上で直感的に把握することが難しくなっています。

## 解決策案

グラフ上でのラベルの重なりを軽減し、視認性を向上させるために、以下のいずれか、または組み合わせによる改善策を検討します。

*   **ラベル表示の選択的ON/OFF:** ユーザーが表示したいラベルを選択したり、一定数以上のラベルはデフォルトで非表示にする機能を追加する。
    > 「ラベル全部は表示しない設定」
*   **重なり回避アルゴリズムの導入:** ラベルの位置を自動的に調整し、重なりを最小限に抑えるアルゴリズムを実装する。
*   **インタラクティブなラベル操作:** ユーザーがグラフ上でラベルをドラッグ＆ドロップして任意の位置に移動できるようにする。
*   **ズームレベルに応じた表示制御:** グラフの拡大率に応じて、表示するラベルの数を調整する（例: 縮小時は主要なラベルのみ表示）。

**コメント:** なし

---

### [[FEATURE]レポート表示画面上で、使用したプロンプトを直接編集可能にする](https://github.com/digitaldemocracy2030/kouchou-ai/issues/293)

**作成者:** nishio  
**作成日:** 2025-04-13T00:58:21Z  
**内容:**

## 課題

現在、生成された広聴AIレポートの内容（特に要約文言など）に不満があり修正したい場合、以下の手順を踏む必要があり、手間と時間がかかります。

1.  Admin Dashboard画面に戻る。
2.  対象のレポートを探して複製する。
3.  複製したレポートの設定（主にプロンプト）を調整する。
4.  再度レポート生成を実行する。

> 「ユーザーとして、広聴AIレポート画面で出力された成果物に不満があり作り直したい場合に、手間と時間がかかる（Admin Dashboard画面に戻り、レポートを複製し、文言調整を行う。1度の修正ごとにレポートが1枚のレポートを生成する必要がある）」

特に、プロンプトの微調整を繰り返して最適な出力結果を得たい場合、この往復作業は大きな負担となります。

## 提案

レポート表示画面（例: `http://localhost:5173/reports/{report_id}`）に、そのレポート生成に使用されたプロンプトを表示し、**直接編集および更新（再生成）** できる機能を追加します。

**具体的な流れ:**

1.  レポート表示画面の下部など（例: 現状「分析手順」が表示されている箇所）に、編集可能なプロンプト入力欄を表示する。
2.  ユーザー（※後述の権限者のみ）がプロンプトを編集する。
3.  「更新して再生成」のようなボタンをクリックすると、編集後のプロンプトを使用してレポートの再生成処理が開始される。
4.  レポート表示画面が更新され、新しい結果が表示される。

これにより、Admin Dashboardに戻ることなく、試行錯誤しながらレポートの質を効率的に向上させることが可能になります。（参考: TTTCTurboのレポート画面における同様の機能）
> 「TOBE：利用したプロンプトを編集、更新できる（参考TTTCTurboのレポート画面）」

## 考慮事項

*   **権限管理:** 広聴AIでは、レポートの作成権限を持つユーザーと閲覧権限のみを持つユーザーが存在する想定です。プロンプトの編集・再生成機能は、**レポート作成権限を持つユーザーのみ**が利用できるように制限する必要があります。閲覧権限のみのユーザーには、プロンプトの表示は行うかもしれませんが、編集・再生成ボタンは表示しない、または無効化するなどの制御が必要です。
*   **コスト:** レポートの再生成にもLLM APIのコストが発生するため、実行前に確認を促すなどのUI上の配慮が必要になる可能性があります。
*   **UI/UX:** プロンプト編集エリアのデザイン、再生成中のステータス表示方法などを検討する必要があります。


**コメント:** なし

---

### [[DOCUMENT]OpenAI APIの課金設定に関する混乱](https://github.com/digitaldemocracy2030/kouchou-ai/issues/292)

**作成者:** nishio  
**作成日:** 2025-04-13T00:52:56Z  
**内容:**

# 現在の問題点
非エンジニアにとって、OpenAI APIキーの取得と課金設定（クレジット購入）が必要であることが分かりにくく、ChatGPT Plusと混同しやすい。設定不備によりQuota超過エラー (429) が発生する。

「OpenAIの課金の設定してなかった」
「Error code: 429 - 'You exceeded your current quota, please check your plan and billing details.'」
「非エンジニアの場合、環境を設定した際にOpenAI APIに課金するというステップがわからない(たねのぶ)」
「OpenAIに課金=ChatGPT Plusだと思う人もいる」

# 提案内容
<!-- どのようなリファクタリングを提案するのか、具体的に説明してください -->
(解決策) READMEに、OpenAI APIキーの取得手順と、ChatGPT Plusとは別にAPI利用のためのクレジット購入（支払い方法登録）が必要であることを明記する。Quota超過エラーの意味と対処法も説明する。


**コメント:** なし

---

### [[FEATURE]階層図のUI/UX改善](https://github.com/digitaldemocracy2030/kouchou-ai/issues/290)

**作成者:** nishio  
**作成日:** 2025-04-13T00:49:58Z  
**内容:**

# 背景
階層図の操作性や情報表示に改善の余地がある (クリック操作の分かりにくさ、表示リセット、親子関係不明瞭、命名規則、戻るボタン欠如)。

from 4/12 meetup
>「階層図のギミックを確認、初見でクリックによって深層に移動できることがわからなかった。」
「全体図、濃い意見グループ、階層図を行き来するときに階層図の表示がリセットされなくなるとうれしい。」
「濃い意見グループで上がってきているクラスタが第一階層？のクラスタのどれに属すのかがわかるとうれしい。」
「階層図の第一階層？第二階層の名前が決まっていると嬉しい。」
「「１階層前に戻る」ボタンがあると助かります」

# 提案内容
(解決策) クリック操作のガイド表示、表示状態の保持、親子関係の明示（例: パンくずリスト）、階層命名規則の明確化、戻るボタンの追加など、UIを改善する。


**コメント:** なし

---

### [[BUG]ScatterChartの全画面表示で要約文が「全画面終了」ボタンの後ろに隠れないようにする処理が不安定](https://github.com/digitaldemocracy2030/kouchou-ai/issues/283)

**作成者:** masatosasano2  
**作成日:** 2025-04-12T18:36:39Z  
**内容:**

### 概要
Issue #278 が PR #282 で修正されたが、以下の課題が残ったため本Issueに切り出された。

PR #282 の修正内容
![Image](https://github.com/user-attachments/assets/a7a1bd58-febe-4993-a49a-2612b1c90ec9)

残課題
![Image](https://github.com/user-attachments/assets/3d080c1d-1502-4b09-8aca-fb2c1fdb9e52)

### 再現手順

1. 「全体図」または「濃い意見グループ」モードを選択する
2. 「全画面表示」ボタンを押す
3. ブラウザのサイズを極力小さくする
4. 画面上部の、右端より少し左側あたりでマウスを動かし続ける

### 期待する動作

要約文が「全画面終了」ボタンの後ろに隠れない（正確には、隠れたままにならない）ようにする


**コメント:** なし

---

### [[BUG] 静的ファイルがGithub Pagesでうまく表示されない件](https://github.com/digitaldemocracy2030/kouchou-ai/issues/274)

**作成者:** keisuke-a  
**作成日:** 2025-04-10T06:52:19Z  
**内容:**

### 概要

静的ファイルをoutして、その中身をgithub pagesで公開すると、out/index.html自体は表示はされるが、画像要素がなかったりリンク先（個別ページ）が404になるなど、うまく表示されない。（参照が絶対パスになってることによる？）


**コメント:** なし

---

### [[DOCUMENT] 静的ファイルのホスティング手順のドキュメント化](https://github.com/digitaldemocracy2030/kouchou-ai/issues/271)

**作成者:** nasuka  
**作成日:** 2025-04-09T13:48:25Z  
**内容:**

# 現在の問題点
* static exportで出力したhtmlファイルを、ユーザー（出力者）がどのようにホスティングすべきかわからないことがある
  * ホスティングには一定のソフトウェアエンジニアリングの知識が必要

# 提案内容
ホスティング方法に関するマニュアルを記載する
ホスティングするサービスの候補としては以下がありそう？

* Github Pages
  * issue起票済み
    * https://github.com/digitaldemocracy2030/kouchou-ai/issues/235
  * 無料で利用可能  
  * 認証がかけられないのがネックになる可能性がある
* Netlify
  * 認証をかけられる & 設定も比較的容易なので、Netlifyを採用できる組織・ユーザーであれば、機能としては恐らくこちらが要件に適しているケースは多そう
  * ただし、そもそも利用者側でNetlifyを契約できない可能性がある
* AWS/Azure
  * 元々これらのクラウドサービスを契約しているのであれば、利用者側での導入は最も容易だと思われるが、設定としてはGithub Pages/Netlifyよりも複雑になりそう


AWS/Azureでのニーズがどの程度あるのか見えていないので、一旦Github Pages/Netlifyあたりの手順をまとめられると良さそう？

**コメント:** なし

---

### [[FEATURE]クラスタ数が増えた場合に散布図上でクラスタラベルが被ってしまう](https://github.com/digitaldemocracy2030/kouchou-ai/issues/266)

**作成者:** nasuka  
**作成日:** 2025-04-08T14:20:10Z  
**内容:**

# 背景
* クラスタ数が増えた場合に散布図上でクラスタラベルが被ってしまう
  * 添付画像は40件で出力したケース。多くのクラスタラベルが被ってしまっている。
![Image](https://github.com/user-attachments/assets/c8e61e43-ef60-4054-91d0-4b8f3e6f4847)

* この問題により、現在は第一階層のクラスタ数を大きな数値に設定できない
  * 現在は上限を20としているが、TTTCの過去事例では30件を表示していたケースもあるため、上限をもう少し大きくしたい

# 提案内容
解決するアプローチは幾つかありそう。

## 対策方針（Claudeによる案）
1. ラベル表示の選択的制限

- 重要度ベースの選択：クラスタサイズなどに基づき重要なラベルのみ表示
- 最大表示数の制限：表示するラベル数に上限を設定（例: 最大15個）
- ユーザー選択型表示：選択されたクラスタのみラベル表示

2. ラベルの視覚的最適化

- フォントサイズの縮小：ラベルのフォントサイズを小さくして占有面積を減らす
- 可変フォントサイズ：クラスタの重要度に応じてフォントサイズを調整
- ラベル省略表示：長いラベルを省略形で表示（例: "長いラベル名" → "長いラ..."）

3. インタラクティブ手法

- 凡例コンポーネントの追加：画面端に凡例を設け、クラスタ一覧を表示
- ホバー/クリック表示：マウスホバーやクリック時のみラベルを表示
- ハイライト機能：選択クラスタを強調し他を半透明化

4. レイアウト最適化

- ラベル位置の調整：ラベル同士の衝突を検出し位置を最適化
- クラスタのグルーピング：近接するクラスタを階層的に表示

**コメント:** なし

---

### [[FEATURE]階層図で一番下まで到達した時には原文を見せても良いのではないか](https://github.com/digitaldemocracy2030/kouchou-ai/issues/250)

**作成者:** takahiroanno  
**作成日:** 2025-04-08T02:23:21Z  
**内容:**

# 背景

より情報量を増やしたい。原文を確認できるとより情報量が増えるなと思った。
![Image](https://github.com/user-attachments/assets/52f7591f-1d06-419b-97a3-2e0e382c2d46)

↑ご覧のように画面がスパースになる

- Xなど、利用規約的に出すことができないものはその旨を表示すると良いと思う

# 提案内容
<!-- 実装案やデザイン案があれば記入してください -->

**コメント:** なし

---

### [[DOCUMENT] README に GitHub Pages で公開する手順を記載する](https://github.com/digitaldemocracy2030/kouchou-ai/issues/235)

**作成者:** shgtkshruch  
**作成日:** 2025-04-05T07:07:57Z  
**内容:**

# 現在の問題点
<!-- 現在のコードの何が問題なのか、どのような技術的負債があるかを説明してください -->

- client を static build して GitHub Pages で公開する場合、ビルドしたファイルをアップロードすると一部のコードが動かない
  - 原因: GitHub Pages で動いている Jekyll が `_` から始まるファイルやディレクトリを無視するため、static build 後の `_next` 以下のファイルが 404 になる
    - https://github.blog/news-insights/the-library/bypassing-jekyll-on-github-pages/
  - `.nojekyll` というファイルをルートに置くと動くようになるが、この挙動は知らない人が多そうで GitHub Pages で公開する人が同じ罠にハマる可能性がある

# 提案内容
<!-- どのようなリファクタリングを提案するのか、具体的に説明してください -->

- README の静的ファイル出力のセクションに、GitHub Pages で公開する場合の手順を記載する
  - ルートに `.nojekyll` ファイルを追加することもここに記載する

**コメント:** なし

---

### [[FEATURE]濃い意見グループの設定画面について](https://github.com/digitaldemocracy2030/kouchou-ai/issues/227)

**作成者:** nishio  
**作成日:** 2025-04-03T13:37:38Z  
**内容:**

# 背景

![Image](https://github.com/user-attachments/assets/bb76f174-3347-4e73-aeed-823e8f4272d1)
最小クラスタは2以上。上が10でいいかは少し微妙で、2,5,10,25,50,100くらいの選択式がいいかもという気持ち
閉じるボタンが文章に被んている件、見出しと説明が横並びなのを縦並びにすると良いかも
「濃いグループの設定しかないので中に入れたらどうか」という話が以前悪化が、この設定によって濃いグループを選択できるかどうかが変わるのでそとにあるべき、将来的にはカラーバレットの設定などもここにはいるのかなと思う

<!-- なぜその機能が必要なのか、何が改善されるのか具体的に記入してください -->


# 提案内容
<!-- 実装案やデザイン案があれば記入してください -->

**コメント:** なし

---

### [(情報整理)試行錯誤の負担を減らす](https://github.com/digitaldemocracy2030/kouchou-ai/issues/221)

**作成者:** nishio  
**作成日:** 2025-04-02T11:45:10Z  
**内容:**

とりあえず立てて、あとで詳細化します

from 4/2定例
>使うまでの準備工数に認識のギャップがある
>プロンプトやクラスタ数等、様々なチューニングを行う必要があるが、その認識がない
>試行錯誤の負担を減らす必要がある(& ドキュメント？)

>自治体の典型的な使い方がわかったら型を示せる

>100件、1000件とサンプリングする？→黙ってやると有害、確認ダイアログがあるといい

- クラスタ数の変更はextraction, embeddingが終わった後のデータでスピーディにできる 関連: https://github.com/digitaldemocracy2030/kouchou-ai/issues/19
- extractionの試行錯誤の負担を減らす仕組みが必要

- いきなり1万件入れて1時間くらい待たされる →　https://github.com/digitaldemocracy2030/kouchou-ai/issues/11

- https://github.com/digitaldemocracy2030/kouchou-ai/issues/241

**コメント:** なし

---

### [[FEATURE]クラスタ説明文におけるグラウンディングの実装](https://github.com/digitaldemocracy2030/kouchou-ai/issues/172)

**作成者:** nasuka  
**作成日:** 2025-03-25T08:07:39Z  
**内容:**

# 背景
* クラスタの説明文では所属する意見の内容を解説しているが、本当にそのような意見が存在するのか確認するのに手間がかかる
* レポートの説得力を増す上で、説明の根拠となる元データを簡単に参照できるようにしたい


# 提案内容
* クラスタ説明文において、その根拠となるargumentを紐づけたテキストを表示する
  *  参考: https://medium.com/jigsaw/making-sense-of-large-scale-online-conversations-b153340bda55
    * Groundings
    * 紐づけ方・紐づけた文章の生成のさせ方は様々なアプローチがあるので、アプローチを検討する部分からassigneeの方にお任せする

# 進め方について
* いきなり機能を実装するのではなく、プロダクトとは独立して実験スクリプトを実装し、検証用のデータセットを使って結果の妥当性を評価する
  * 問題なければプロダクトの機能として実装を進める
  * 一旦実験系のIssueだけ立てておき、機能することがわかった段階でプロダクトへの実装イシューを立てる



**コメント:** なし

---

### [（実験）LLMによるクラスタ品質の自動評価](https://github.com/digitaldemocracy2030/kouchou-ai/issues/144)

**作成者:** nasuka  
**作成日:** 2025-03-25T03:36:54Z  
**内容:**

# 背景
https://github.com/digitaldemocracy2030/kouchou-ai/issues/143

* こちらのイシューは上記のサブイシュー


# 提案内容
* LLMによるクラスタ品質の自動評価の実験を行う
  * 出力されたクラスタタイトル・説明文・所属データ点の情報に基づいて、LLMでクラスタの品質を評価する
* どのようなアプローチで評価するかは、assigneeの方におまかせする
  * 例としては、例えば以下のような評価項目のスコアをLLMで出力するようなアプローチがある
    * クラスタ内部の一貫性評価
      * クラスタタイトル・説明文・所属データのテキストを入力し、一貫性を100点満点でスコアリングする
    * クラスタ外部との分離度の評価
      * クラスタAの情報（タイトルや所属データ等）と、重心の距離が最もAに近いクラスタBの情報をLLMに入力し、分離度を出力する


**コメント:** なし

---

### [[DOCUMENT]ソースコードの実装以外での貢献方法がもっと言語化されるとよい](https://github.com/digitaldemocracy2030/kouchou-ai/issues/130)

**作成者:** nishio  
**作成日:** 2025-03-22T14:31:29Z  
**内容:**

# 現在の問題点
非エンジニアが何をしたらいいかわからない

# 提案内容

例えば
- GitHubのissuesをみて「その問題が解決されると自分も助かる！」と思ったものに:+1:をつけるのはタスクの優先付の参考になるので貢献
- 質問をするのは言語化のきっかけになるので貢献
- 将来的に「AのレポートとBのレポートのどっちがいいですか？」をやる可能性がある、そう言うのに回答してくれるのは貢献

他に思いついたら下にコメントつけてください

**コメント:** なし

---

### [[REFACTOR] 濃いクラスタのアイコン変更](https://github.com/digitaldemocracy2030/kouchou-ai/issues/113)

**作成者:** nishio  
**作成日:** 2025-03-20T12:20:30Z  
**内容:**

# 現在の問題点

<img width="249" alt="Image" src="https://github.com/user-attachments/assets/bc626d04-e7c0-4245-9b01-e762d433a434" />

濃いクラスタのアイコンは特に意味はなくこれになっている


# 提案内容

多分叩き台の案がないとどう変えたらいいかの議論もできないと思うので雑に描いておく

![Image](https://github.com/user-attachments/assets/9e46dfd6-71d4-4c2b-bbd5-1c79220c8d80)

アイコンとしてデザインできるかは度外視して描くとこんな感じで「全体像」は全体にたくさんの点が散らばっており、「濃いクラスタ」はぎゅっとした「濃い」「密度の高い」塊がいくつかある感じ

**コメント:** なし

---

### [[FEATURE]用語解説ページをつける](https://github.com/digitaldemocracy2030/kouchou-ai/issues/111)

**作成者:** nishio  
**作成日:** 2025-03-20T12:07:35Z  
**内容:**

# 背景
「プロンプト」「埋め込み」「濃い(クラスタ)」について、単語レベルで言い換えてもわかりやすくならない気がするので、やるとしたら用語解説ページをつけるとかかな

「縦軸・横軸はなんだろう」についても解説

# 提案内容
<!-- 実装案やデザイン案があれば記入してください -->

**コメント:** なし

---

### [[FEATURE]CSVアップロード時にそれを処理した場合のコストを表示](https://github.com/digitaldemocracy2030/kouchou-ai/issues/79)

**作成者:** nishio  
**作成日:** 2025-03-18T03:19:29Z  
**内容:**

# 背景

>安野貴博: ファイルアップロードすると解析掛ける前にコストを教えてくれるの良さそうですね
>ほづみゆうき: ついにレポート出力まで漕ぎ着けたのですがAPI料金がどれくらいになるのかまったく感覚的に分からずドキドキだったので素人にはあると嬉しいと思います！

# 提案内容

これを実現するためには2つの要素が必要

- 1: done( ~~いまCSVアップロード即処理開始になっているが、一旦確認ダイアログを挟む必要がある~~ )
- 2: どのくらいのデータだとどれくらいの費用になるのかの見積もり関数が必要

## (2)の真面目な作り方

(1)は @nanocloudx さんが詳しいと思うが、(2)の部分がわからなくて着手できないと思う。
UI改善に着手する前に、この関数を作るためのデータ自体を集めていないのでそこからやる必要がある。

- a: extraction
- b: embedding
- c: その後のレポート作成

(a)がO(N)でgpt4oなので大きく、(b)はO(N)だがembedding modelなので安く、cはクラスタ数のオーダー(階層モデルなど今回いろいろ追加したから読めない)という感じで、このそれぞれに分けて料金を出せるようにしてデータ量違いでデータを集めればよい。

## (2)の雑な作り方

ユーザのペインは「すごい高額だったらどうしよう」だと思うので、まず「100円未満っすね」「100~1000円くらい」「これはでかいから1000円以上かかるよ」の3段階でいいのでは説

**コメント:** なし

---

### [[FEATURE]階層図で、最下層の表示を濃いクラスタだけに絞る](https://github.com/digitaldemocracy2030/kouchou-ai/issues/60)

**作成者:** nasuka  
**作成日:** 2025-03-16T07:27:43Z  
**内容:**

# 背景
* 階層図において、最下層のクラスタ数が多すぎるため内容を把握しにくいケースがある


# 提案内容
* 濃いクラスタのフィルタを反映した上で、階層図の最下層クラスタを表示する
  * フィルタはデフォルトで適用しつつ、ON/OFFを切り替えられると良さそう？

**コメント:** なし

---

### [[FEATURE] 元コメントの表示機能](https://github.com/digitaldemocracy2030/kouchou-ai/issues/56)

**作成者:** nanocloudx  
**作成日:** 2025-03-16T04:00:23Z  
**内容:**

# 背景
現在表示されている文言は、AIが要約した文章(arguments または clusters)である
arguments の生成元となった comments も参照できると良い
（全て表示すると視認性が下がるため、オプションとして表示する項目があると望ましい）

# 提案内容
- hierarchical_result.json に comment を追加する
  - 元コメントは引用がNGの場合があるので、引用元の規約に注意する必要がある
- レポート表示に元コメントを表示するオプションを追加する

**コメント:** なし

---

### [[FEATURE]レポート出力にかかる時間の目安を記載する](https://github.com/digitaldemocracy2030/kouchou-ai/issues/11)

**作成者:** nasuka  
**作成日:** 2025-03-04T10:59:48Z  
**内容:**

# 背景
* レポート出力までに何分程度かかるのかがユーザー目線でわからない


# 提案内容
* 実行時間の目安を記載する


**コメント:** なし

---

## Pull Requests

### 過去7日間にマージされたPR (15件)

### [ところてんさんをメンテナーに追加](https://github.com/digitaldemocracy2030/kouchou-ai/pull/449)

**作成者:** nasuka  
**作成日:** 2025-05-07T06:35:52Z  
**変更:** +1 -0 (1ファイル)  
**マージ日:** 2025-05-07T06:36:02Z  
**内容:**

# 変更の概要
ところてんさんをメンテナーとして追加

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました

**コメント:** なし

---

### [Labeling prompt improvement](https://github.com/digitaldemocracy2030/kouchou-ai/pull/446)

**作成者:** masatosasano2  
**作成日:** 2025-05-07T01:35:12Z  
**変更:** +45 -34 (1ファイル)  
**マージ日:** 2025-05-07T06:18:21Z  
**内容:**

# 変更の背景
ラベルの自動付与処理のうち、LLMに判定させる箇所の精度が低い。

# 変更の概要
Promptを改善した。

# 検証結果
https://docs.google.com/spreadsheets/d/1XqtM7-eEbcjku2OWjHeD9js-1nHtlNXQY2UMM83ziJo
修正前のpromptと加えて改善傾向にある。

# 関連Issue
#444

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
- [x] CLAの内容を読み、同意しました

**コメント:** なし

---

### [api コンテナの build 時間を短縮する ](https://github.com/digitaldemocracy2030/kouchou-ai/pull/442)

**作成者:** shingo-ohki  
**作成日:** 2025-05-06T11:30:05Z  
**変更:** +20 -6 (4ファイル)  
**マージ日:** 2025-05-06T12:39:22Z  
**内容:**

# 変更の概要
- api コンテナの build 時間を短縮するため、GPU を使わない場合にはより適切なパッケージ(torch の GPUサポートなし）のインストールを行うようにしました
- これにより、GPU を使わない場合は api の build 時間が従来の半分以下程度（マシンスペックやネットワーク環境次第ですが、手元の環境では 17 -> 7分）になります

# 変更の背景
- セットアップを試した方からセットアップ時間についてフィードバックがあった
- ここ最近、作業時に build 時間が伸びた気がしていた
- 他にも build 時間が長くなったと感じている人がいた
- [調査](https://github.com/digitaldemocracy2030/kouchou-ai/issues/432#issuecomment-2850411787)の結果、セットアップ時間の大半は api の build （特に nvidia-* 系のパッケージのインストール）処理だった
- これらのパッケージ（のGPUサポート）は、GPUによる処理を行わない場合には不要と思われる
- （おそらく）GPUによる処理を行うユーザーは一部

# 関連Issue
https://github.com/digitaldemocracy2030/kouchou-ai/issues/432

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました

**コメント:** なし

---

### [metadata が未設定の場合でもリンクがエラーにならないようにする](https://github.com/digitaldemocracy2030/kouchou-ai/pull/435)

**作成者:** takumi19910112  
**作成日:** 2025-05-06T02:47:59Z  
**変更:** +92 -74 (10ファイル)  
**マージ日:** 2025-05-06T06:11:56Z  
**内容:**

# 変更の概要
- [以前提出したPR](https://github.com/digitaldemocracy2030/kouchou-ai/pull/423)の中で、[コメントをいただいた部分](https://github.com/digitaldemocracy2030/kouchou-ai/pull/423#pullrequestreview-2813700429)の修正&微調整のためのPRになります。

# スクリーンショット
- UIの変更を伴う場合は、変更前後のスクリーンショットもしくはgif画像をこちらに記載してください
- カスタムなし
<img width="1915" alt="スクリーンショット 2025-05-06 11 42 33" src="https://github.com/user-attachments/assets/fcf6117e-7fd2-43fe-a8a7-8baea300f69d" />
<img width="1915" alt="スクリーンショット 2025-05-06 11 35 14" src="https://github.com/user-attachments/assets/15e66e39-ae97-4c27-8a56-46b8b21773c0" />


<img width="1912" alt="スクリーンショット 2025-05-06 11 44 47" src="https://github.com/user-attachments/assets/af04adaa-6469-4e70-b808-4c0fa869deab" />

- カスタムあり
<img width="1915" alt="スクリーンショット 2025-05-06 11 34 55" src="https://github.com/user-attachments/assets/8eebeb3d-1abb-4148-84db-a510b696e74e" />

<img width="1907" alt="スクリーンショット 2025-05-06 11 41 40" src="https://github.com/user-attachments/assets/10ebfc91-8329-41c9-b471-173b048f2c73" />

<img width="958" alt="スクリーンショット 2025-05-06 11 36 37" src="https://github.com/user-attachments/assets/097a735a-a2a0-40b2-8ee3-f305aa2fc2bc" />


# 変更の背景
- [こちら]([REFACTOR] metadata のオプショナル化 #403)のPRで対応できていなかった部分を修正しました。
- 冗長な表現や、フッターやAbout、ヘッダーについて、一貫性がある処理にしました（デフォルトの場合は基本的には画像やリンクなどの値は非表示にし、カスタムがあり、かつ、画像やリンクがある場合のみ表示するようにしました）
- また、READMEについて今回の修正に合わせた内容にしました
- metadataについても、万が一リンクが表示されても問題ないリンクに変更しました。

# 関連Issue
https://github.com/digitaldemocracy2030/kouchou-ai/issues/403

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました

**コメント:** なし

---

### [カラムの自動選択アルゴリズムを追加](https://github.com/digitaldemocracy2030/kouchou-ai/pull/429)

**作成者:** tokoroten  
**作成日:** 2025-05-04T20:05:31Z  
**変更:** +133 -31 (3ファイル)  
**マージ日:** 2025-05-06T01:50:25Z  
**内容:**

# 変更の概要
- commentという名前以外にも、様々な名前のカラムをデフォルトカラムとして自動選択するように配列化
- CSVをアップロードした際に、自動的にコメントカラムを推定して、そのカラムを初期値にする

## コメントカラムの推定アルゴリズム

- 自由記述欄は文字数のばらつきが極めて大きい
- 選択肢やログや属性情報のカラムは、文字数のばらつきが少ない
- この仮定から、文字列長の上側2σの値をスコアとして採用する（文字列の長さの95パーセンタイル値とかでもよかったかも）
  - score = 平均文字列長 + 2 * 文字列長の分散

# スクリーンショット
![dd2030-auto_select_column](https://github.com/user-attachments/assets/c00f725e-c4de-43b8-a4bb-729da2cf0261)

# 変更の背景
- テストで何度もCSVをアップロードする作業をしていて、毎回カラムを変更するのがツラかった…

# 関連Issue
#304

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました

**コメント:** なし

---

### [[REFACTOR] metadata のオプショナル化 #403](https://github.com/digitaldemocracy2030/kouchou-ai/pull/423)

**作成者:** takumi19910112  
**作成日:** 2025-05-03T15:27:03Z  
**変更:** +128 -39 (6ファイル)  
**マージ日:** 2025-05-05T02:35:54Z  
**内容:**

# 変更の概要
- metadata.jsonというファイルにレポート作成者について記載することで、その情報を管理者側とクライアント側に画像やリンクとして表示させることができる。
- 現在はデフォルトのmetadataに、「テスト環境」という画像が用意されているが、これがそのまま使用されているかもしれない
- また、リンク先がexample.comなので初見ユーザがクリックしてエラーページになってしまうケースもある
- 上記を解決するために、デフォルトの状態や、custom_metadataに画像や値がない場合は非表示とする方針に変更した。

# スクリーンショット
- UIの変更を伴う場合は、変更前後のスクリーンショットもしくはgif画像をこちらに記載してください
- 変更前
<img width="1457" alt="スクリーンショット 2025-05-04 21 32 32" src="https://github.com/user-attachments/assets/42e82ca9-4219-415c-910e-2d88f9a21069" />
<img width="1461" alt="スクリーンショット 2025-05-04 21 32 38" src="https://github.com/user-attachments/assets/2f9140d6-01e2-4652-b39c-c5f4f963a678" />


- 変更後
- デフォルトの場合

<img width="1467" alt="スクリーンショット 2025-05-04 20 59 51" src="https://github.com/user-attachments/assets/72165321-1b46-4cdd-925e-66c92c903158" />



<img width="1463" alt="スクリーンショット 2025-05-04 20 54 53" src="https://github.com/user-attachments/assets/01987e1e-eb6e-4494-9055-9fbec6d68b08" />

- custum_metadataを用意した場合
<img width="734" alt="スクリーンショット 2025-05-04 21 01 33" src="https://github.com/user-attachments/assets/d2164202-aeb5-45b2-beff-16579a7d68fb" />

![Uploading スクリーンショット 2025-05-04 21.35.15.png…]()




# 変更の背景
- 変更の概要にも記載いたしましたが、テスト環境という画像や、誤ったリンクが表示されてしまうことを防ぐためです。

# 関連Issue
[[REFACTOR] metadata のオプショナル化 #403](https://github.com/digitaldemocracy2030/kouchou-ai/issues/403)

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました

**コメント:** なし

---

### [Client-AdminにChatGPTのAPIKeyの確認画面の追加](https://github.com/digitaldemocracy2030/kouchou-ai/pull/421)

**作成者:** tokoroten  
**作成日:** 2025-05-03T13:19:34Z  
**変更:** +216 -4 (3ファイル)  
**マージ日:** 2025-05-06T23:53:53Z  
**内容:**

# 変更の概要
- 管理画面の追加
- とりあえずOpenAIのAPIを一発叩いてみて、動作確認
- エラーが出たら、エラーを分かりやすく表示

# スクリーンショット
![image](https://github.com/user-attachments/assets/f4e0a02b-3fb1-4e3d-9eed-c624273ec0cb)
![image](https://github.com/user-attachments/assets/5193c5bc-5ea3-4740-aeca-22ab50a27dce)
![image](https://github.com/user-attachments/assets/e6c4a57d-86fa-4bce-809e-3e59aee058af)


# 変更の背景
- envでAPIKeyが正しく設定されているか分からない
- APIのデポジットに正しくチャージされているか分からない

# 関連Issue

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました

**コメント:** なし

---

### [ラジオボタンに見た目を変更](https://github.com/digitaldemocracy2030/kouchou-ai/pull/418)

**作成者:** takumi19910112  
**作成日:** 2025-05-02T14:25:17Z  
**変更:** +131 -46 (2ファイル)  
**マージ日:** 2025-05-03T02:48:10Z  
**内容:**

# 変更の概要
- 下記リンクに記載のIssueの対応となります。
- 機能面は変更せずに、「公開中」と「非公開」のボタンを、ラジオボタンで選択できる形式としました。

# スクリーンショット
- UIの変更を伴う場合は、変更前後のスクリーンショットもしくはgif画像をこちらに記載してください
- 変更前
<img width="1913" alt="スクリーンショット 2025-05-02 23 48 44" src="https://github.com/user-attachments/assets/be770ad0-9992-41f3-81d5-6486de380478" />
- 変更後
<img width="1911" alt="スクリーンショット 2025-05-03 0 19 06" src="https://github.com/user-attachments/assets/87232996-19c0-46b2-a4f1-f3c78e0a92cc" />





# 変更の背景
- チャクラUIの「ラジオ」か、「ラジオカード」のどちらが適しているか考えました。
- 「ラジオカード」だと、すでに使用されていたので画面にあっているかと考え採用しました。（ラジオの方がよかったらご指摘ください）
- 使用されていた箇所（client/components/charts/SelectChartButton.tsx）

# 関連Issue
[[FEATURE]「公開」ボタンを押した時の効果を分かりやすくする](https://github.com/digitaldemocracy2030/kouchou-ai/issues/302)

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました

**コメント:** なし

---

### [static exportでbase pathを設定可能にする(Github Pages対応)](https://github.com/digitaldemocracy2030/kouchou-ai/pull/413)

**作成者:** mtane0412  
**作成日:** 2025-05-01T15:19:16Z  
**変更:** +122 -22 (10ファイル)  
**マージ日:** 2025-05-02T15:40:07Z  
**内容:**

# 変更の概要
`.env` に`NEXT_PUBLIC_STATIC_EXPORT_BASE_PATH=/kouchou-ai-reports`などのように記述して、Github Pagesのようなサブディレクトリへのデプロイでもパスを上手く解決するようにする
(ルートドメインにデプロイするときは今まで通り記述なし)

*   **静的エクスポートのベースパス対応:**
    *   `.env.example` と `Makefile` に `NEXT_PUBLIC_STATIC_EXPORT_BASE_PATH` 環境変数を追加し、ビルド時にベースパスを指定できるようにしました。(`Makefile`, `.env.example`)
    *   `next.config.ts` で `basePath` と `assetPrefix` を静的エクスポート時に動的に設定するように変更しました。(`client/next.config.ts`)
*   **パス解決ユーティリティの改善:**
    *   `image-src.ts` をリファクタリングし、`getBasePath`, `getRelativeUrl`, `getImageFromServerSrc` 関数を導入しました。これにより、静的エクスポート時と通常時で画像やアセットのパスを正しく解決できるようになります。(`client/app/utils/image-src.ts`)
    *   各ページコンポーネント (`[slug]/page.tsx`, `page.tsx`) やコンポーネント (`BroadlisteningGuide.tsx`) で、新しいパス解決ユーティリティを使用するように修正しました。(`client/app/[slug]/page.tsx`, `client/app/page.tsx`, `client/components/report/BroadlisteningGuide.tsx`)
*   **APIベースURL解決の改善:**
    *   `api.ts` の `getApiBaseUrl` 関数を修正し、サーバーサイドレンダリング時に `API_BASEPATH` 環境変数を優先的に使用するようにしました。(`client/app/utils/api.ts`)

# 変更の背景
> 静的ファイルをoutして、その中身をgithub pagesで公開すると、out/index.html自体は表示はされるが、画像要素がなかったりリンク先（個別ページ）が404になるなど、うまく表示されない。（参照が絶対パスになってることによる？）

# 関連Issue
#274

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました

**コメント:** なし

---

### [Github Projectsの運用ポリシーをドキュメント化](https://github.com/digitaldemocracy2030/kouchou-ai/pull/411)

**作成者:** nasuka  
**作成日:** 2025-05-01T13:59:30Z  
**変更:** +38 -1 (2ファイル)  
**マージ日:** 2025-05-05T02:52:10Z  
**内容:**

# 変更の概要
Github Projectsの運用ポリシーをドキュメント化した

# 変更の背景
これまで運用方針が明文化されていなかったが、デザイナーの方もジョインし、チームの規模も拡大化してきたので認識合わせのためにフローを整備した


# 記載していないこと・迷っていること
* cold listの対応方針は未記載
  * stale botを作って、90日以上更新されていないものは自動でcloseするなどしたほうが良さそう
*メンテナーがイシューをメンテナンスするタイミングについて
  * 本来は定期的（例えば週一）にメンテナンスをすべきだが、OSSなのでそれを義務化するのも難しいなと思っており、そちらは明文化していません（個々のメンテナの自助努力に任せる想定）
    * 妙案ある方がいたらコメントもらえると嬉しいです

# 備考
* デザイン関連のタスクは一旦サブイシューを切る想定にしていますが、実際にデザインされる方のご意見を伺いながら適宜修正したいと思っています

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました

**コメント:** なし

---

### [Solve #409 automate Issues labeling with Github Actions and LLM](https://github.com/digitaldemocracy2030/kouchou-ai/pull/410)

**作成者:** masatosasano2  
**作成日:** 2025-05-01T13:30:29Z  
**変更:** +218 -0 (3ファイル)  
**マージ日:** 2025-05-02T13:17:38Z  
**内容:**

# 変更の概要
- Issue起票時にGithub Actionsで内容をチェックし、以下の観点で相応しいラベルを付与します
    - ~公序良俗に反するかどうか~
    - ~既存のIssueと重複するかどうか~
    - タイトルの先頭の[text]や絵文字
    - タイトルと本文の内容

# 変更の背景
- 1つのIssueが複数の属性を持ちうるため、タイトルの先頭の[text]や絵文字ではなく、複数指定もフィルタもしやすいラベルを活用したい。
- しかし、ラベルを付与できるのはWrite権限以上を持つユーザーに限られる。
- そのため、ラベルの管理コストがメンテナに集中してしまう。

# 関連Issue
#409

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました

**コメント:** なし

---

### [static build時のフォントキャッシュを追加](https://github.com/digitaldemocracy2030/kouchou-ai/pull/408)

**作成者:** mtane0412  
**作成日:** 2025-05-01T11:20:18Z  
**変更:** +22 -6 (1ファイル)  
**マージ日:** 2025-05-02T03:20:40Z  
**内容:**

# 変更の概要
- report数分だけfetchFontでGoogle Fontsをダウンロードしていたのをフォントキャッシュオブジェクトに保存して再利用するようにした

# 変更の背景
- 静的ページを25出力しているが、引き続きmake client-build-staticが安定しない ( #343 と同様のエラー)
- #344 の修正を行ったが、HTTPエラーは出ておらず、別の要因でビルドがクラッシュしている可能性
- fetchFontがページ数分callされているので25 pages * 2 font weight = 50 font filesのダウンロードになってクラッシュしてるという推測でフォントキャッシュを作成した。一旦エラーが落ち着いたのでプルリクにしておく

# 関連Issue
#343 
#344 

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました

**コメント:** なし

---

### [濃い意見グループが選択された際にグループの説明文を切り替える](https://github.com/digitaldemocracy2030/kouchou-ai/pull/405)

**作成者:** nasuka  
**作成日:** 2025-04-30T15:16:11Z  
**変更:** +15 -10 (2ファイル)  
**マージ日:** 2025-05-01T02:20:52Z  
**内容:**

# 変更の概要
濃い意見グループが選択された際にグループの説明文を切り替えるようにした

# スクリーンショット
![ad1eda65f4040295521ee4ea5b40fca3](https://github.com/user-attachments/assets/9a31ce08-f7a7-49c2-8eb0-961e611ad110)

# 変更の背景
* 濃い意見グループを表示した際も、全体図と同じクラスタの説明文が並んでしまっていた

# 関連Issue
https://github.com/digitaldemocracy2030/kouchou-ai/issues/24
（issueに記載する内容を詳細化しようと思って、どのへんを直したら良さそうかclineに聞いたらそのまま実装が完了してしまった）

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました

**コメント:** なし

---

### [散布図にズームとパンを追加（あとスクショもできるようになった）](https://github.com/digitaldemocracy2030/kouchou-ai/pull/404)

**作成者:** tokoroten  
**作成日:** 2025-04-30T13:08:13Z  
**変更:** +7 -3 (2ファイル)  
**マージ日:** 2025-04-30T13:47:07Z  
**内容:**

# 変更の概要
散布図をズームとパンで操作できるようにするために、Plotlyのコンフィグを変更した

副次的効果として、スクリーンショットボタンが付いた

# スクリーンショット

![dd2030-plotly](https://github.com/user-attachments/assets/a68e8d26-59dc-43da-a3be-77aa28cea80f)

# 変更の背景
範囲選択して拡大がめんどくさすぎた

# 関連Issue

#306 

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました

**コメント:** なし

---

### [Devinとのコラボレーションについてのドキュメントを追加](https://github.com/digitaldemocracy2030/kouchou-ai/pull/399)

**作成者:** shingo-ohki  
**作成日:** 2025-04-30T04:18:45Z  
**変更:** +140 -62 (2ファイル)  
**マージ日:** 2025-05-01T00:15:14Z  
**内容:**

# 変更の概要
- ドキュメントに Devin についての記述を追加

ChatGPT が提案してくれたものをベースに、実態に合わせて修正してみました。
Issue 自体があくまで仮説なため、あくまで「ないよりはあったほうがいい」というくらいに考えていますが、
これが適切かどうか自信はないので、たたき台と思ってガンガンコメントいただければと思います。

# 変更の背景
Devin との協働に戸惑う開発者もいるだろうと考えられるため、何らかの軽減措置があるとよさそう

# 関連Issue
#398 

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました

**コメント:** なし

---

### 過去7日間に作成されたPR (12件)

### [Feat/evaluation report](https://github.com/digitaldemocracy2030/kouchou-ai/pull/448)

**作成者:** take365  
**作成日:** 2025-05-07T04:30:03Z  
**変更:** +17839 -0 (19ファイル)  
**内容:**

# 変更の概要
- クラスタリング評価結果をCVS形式、HTML形式で出力するレポート生成機能を experimental/evaluation_report 以下に新規追加しました。
- LLM評価（明確さ、一貫性、多様性、代表性）とシルエットスコア（UMAP・Embeddingベース）を統合し、可視化可能なHTMLレポートとして出力します。
- 既存の本番コードには影響しない構成となっており、すべての変更は experimental/ ディレクトリに収まっています。
-タイトル・解説が「エラー」なのに低い評価ができていない、意見が１件の場合の意見のまとまり具合がアンバランスも対応

# 変更の背景
- 現在のクラスタリング評価はCSVやJSON形式が中心であり、利用者や開発者が結果を俯瞰して確認するのが難しい状況でした。
- 本変更により、評価結果を視覚的に確認でき、クラスタリング精度の比較や改善方針の立案が容易になります。
- 将来的に本機能を本体に統合することも視野に入れた、初期実装段階として experimental/ に追加しています。

# 関連Issue
（実験）LLMによるクラスタ品質の自動評価 #144
https://github.com/digitaldemocracy2030/kouchou-ai/issues/144 

# CLAへの同意
- [x] CLAの内容を読み、同意しました


**コメント:** なし

---

### [Feat/evaluation report クラスタ品質の自動評価 #144](https://github.com/digitaldemocracy2030/kouchou-ai/pull/440)

**作成者:** take365  
**作成日:** 2025-05-06T10:05:57Z  
**変更:** +16389 -0 (17ファイル)  
**内容:**

# 変更の概要
- クラスタリング評価結果をCVS形式、HTML形式で出力するレポート生成機能を experimental/evaluation_report 以下に新規追加しました。
- LLM評価（明確さ、一貫性、多様性、代表性）とシルエットスコア（UMAP・Embeddingベース）を統合し、可視化可能なHTMLレポートとして出力します。
- 既存の本番コードには影響しない構成となっており、すべての変更は experimental/ ディレクトリに収まっています。


# 変更の背景
- 現在のクラスタリング評価はCSVやJSON形式が中心であり、利用者や開発者が結果を俯瞰して確認するのが難しい状況でした。
- 本変更により、評価結果を視覚的に確認でき、クラスタリング精度の比較や改善方針の立案が容易になります。
- 将来的に本機能を本体に統合することも視野に入れた、初期実装段階として experimental/ に追加しています。

# 関連Issue
（実験）LLMによるクラスタ品質の自動評価 #144
https://github.com/digitaldemocracy2030/kouchou-ai/issues/144 

# CLAへの同意
- [x] CLAの内容を読み、同意しました


**コメント:** なし

---

### [Feat/evaluation report](https://github.com/digitaldemocracy2030/kouchou-ai/pull/439)

**作成者:** take365  
**作成日:** 2025-05-06T09:56:13Z  
**変更:** +16389 -0 (17ファイル)  
**内容:**

# 変更の概要
- クラスタリング評価結果をHTML形式で出力するレポート生成機能を experimental/evaluation_report 以下に新規追加しました。
- LLM評価（明確さ、一貫性、多様性、代表性）とシルエットスコア（UMAP・Embeddingベース）を統合し、可視化可能なHTMLレポートとして出力します。
- 既存の本番コードには影響しない構成となっており、すべての変更は experimental/ ディレクトリに収まっています。


# 変更の背景
- 現在のクラスタリング評価はCSVやJSON形式が中心であり、利用者や開発者が結果を俯瞰して確認するのが難しい状況でした。
- 本変更により、評価結果を視覚的に確認でき、クラスタリング精度の比較や改善方針の立案が容易になります。
- 将来的に本機能を本体に統合することも視野に入れた、初期実装段階として experimental/ に追加しています。

# 関連Issue
（実験）LLMによるクラスタ品質の自動評価 #144
https://github.com/digitaldemocracy2030/kouchou-ai/issues/144 

# CLAへの同意
- [x] CLAの内容を読み、同意しました


**コメント:** なし

---

### [create](https://github.com/digitaldemocracy2030/kouchou-ai/pull/434)

**作成者:** take365  
**作成日:** 2025-05-05T23:14:47Z  
**変更:** +17397 -0 (18ファイル)  
**内容:**

# 変更の概要
- ここに変更の概要を記載してください

# スクリーンショット
- UIの変更を伴う場合は、変更前後のスクリーンショットもしくはgif画像をこちらに記載してください

# 変更の背景
- ここに変更が必要となった背景を記載してください

# 関連Issue
関連するIssueのリンクをこちらに記載してください

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [ ] CLAの内容を読み、同意しました

**コメント:** なし

---

### [create](https://github.com/digitaldemocracy2030/kouchou-ai/pull/433)

**作成者:** take365  
**作成日:** 2025-05-05T22:06:34Z  
**変更:** +17397 -0 (18ファイル)  
**内容:**

ドラフト

**コメント:** なし

---

### [Issue の Project status の自動更新](https://github.com/digitaldemocracy2030/kouchou-ai/pull/426)

**作成者:** masatosasano2  
**作成日:** 2025-05-04T04:54:21Z  
**変更:** +372 -0 (4ファイル)  
**内容:**

# 変更の概要
GitHub IssuesとGitHub Projectsのステータスフィールドを以下の条件とイベントに基づいて自動的に更新します。
| **条件**  | **きっかけ** | **変更後のstatus** |
| ------------- | ------------- | ------------- |
| Status in [`No Status`, `Cold List`, `Need Refinement`, `Ready`]  | Assign | ~`Ready`~ `In Progress` |
| ~Status = `Ready` and Assigne~  | ~Create PR, post comment~ | ~`In Progress`~ |
| Status = `In Progress` | Unassign | `Ready` |

# 変更の背景
kouchou-ai のIssue数が多く、statusの管理コストが高いため、一部の変更を自動化したい。

# 関連Issue
#425

# 実装詳細
- ~2つの~GitHub Actionsワークフローを作成：
    - `assignee-status-sync.yml`：担当者が追加/削除された時のステータス変更を処理
    - ~`progress-status-sync.yml`：進捗があった時（PRリンク、コメント）のステータス変更を処理~
- GraphQL APIを使用してGitHub Projectsと対話するPythonスクリプトを実装　※ REST API はProjectV2に未対応
- [yamlの中にpython書かない](https://x.com/ssig33/status/1804740980643602792)

必要な設定
Repository > Settings > General > Security > Secrets and variables > Actions > Repository secrets
- **PROJECT_TOKEN** : PAT Token with Projects:write permission
- **PROJECT_ID** : GitHubプロジェクトのID（形式：PVT_xxxx）
- **STATUS_FIELD** : GitHubプロジェクト内のStatusフィールドのID（形式：PVTSSF_xxxx）

**PROJECT_TOKEN** の発行方法：
- https://github.com/settings/personal-access-tokens/new にアクセス
- `Resource owner` > `digitaldemocracy2030`
- `Expiration` > 適当な有効期間
- `Repository access` > `Only selected repositories`
- `Select Repositories` > `kouchou-ai`
- `Permissions` > `Organization Permissions` > `Projects` > `Access: Read and write`
- `Generate token`

**PROJECT_ID** (PVT_xxxx) と **STATUS_FIELD** (PVTSSF_xxxx) の取得方法：
- https://docs.github.com/ja/graphql/overview/explorer にアクセス
- Githubアカウントでログイン ※ `digitaldemocracy2030` のメンバである必要がある
- 以下のクエリを実行:
```
{
  organization(login: "digitaldemocracy2030") {
    projectV2(number: 3) {
      id
      fields(first: 20) {
        nodes {
          ... on ProjectV2SingleSelectField {
            id
            name
          }
        }
      }
    }
  }
}
```

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/kouchou-ai/blob/main/CLA.md)に同意することが必須です。
- [x] CLAの内容を読み、同意しました

**コメント:** なし

---

### [Add provider selection to LLM integration](https://github.com/digitaldemocracy2030/kouchou-ai/pull/422)

**作成者:** shinta.nakayama+Devin  
**作成日:** 2025-05-03T14:54:30Z  
**変更:** +937 -156 (25ファイル)  
**内容:**

# LLM統合へのプロバイダー選択機能の追加

このPRは広聴AIアプリケーションにプロバイダー選択機能を追加し、異なるLLMプロバイダー間で動的に切り替えることを可能にします。

## 変更内容

### バックエンド
- `admin_report.py`スキーマにproviderとlocal_llm_addressフィールドを追加
- `report_launcher.py`にプロバイダー情報を含めるよう更新
- `llm.py`を更新し、環境変数の代わりにproviderパラメータを使用するように変更
- サーバーサイドでのモデル取得機能を追加
- OpenAI SDKを使用したLocalLLMサポートを実装
- パイプラインステップでproviderとlocal_llm_addressパラメータを渡すように修正

### フロントエンド
- プロバイダー選択ドロップダウンを追加
- プロバイダーごとのモデルリストを動的に管理
- LocalLLM用の「モデル取得」ボタンを実装
- WebStorage (localStorage) を使用して設定を保存・読み込み
- LocalLLMプロバイダー選択時にisEmbeddedAtLocalを自動的にチェックし無効化
- **「埋め込み処理をサーバ内で行う」チェックボックスの位置をAIモデルの下に移動**

## Devinセッションへのリンク
https://app.devin.ai/sessions/6ccb4a9b82d7428289074993f6a64371

## リクエスト元
shinta.nakayama@gmail.com


**コメント:** なし

---

### [Devin/1746211334 issue project status sync](https://github.com/digitaldemocracy2030/kouchou-ai/pull/419)

**作成者:** masatosasano2  
**作成日:** 2025-05-02T19:07:11Z  
**変更:** +434 -0 (6ファイル)  
**内容:**

内容なし

**コメント:** なし

---

### [Add support for Open Router and LocalLLM providers](https://github.com/digitaldemocracy2030/kouchou-ai/pull/412)

**作成者:** shinta.nakayama+Devin  
**作成日:** 2025-05-01T14:53:39Z  
**変更:** +469 -157 (9ファイル)  
**内容:**

# Add support for Open Router and LocalLLM providers

This PR adds support for additional LLM providers beyond the current OpenAI and Azure OpenAI options:

- Open Router: Access to multiple AI providers through a unified API
- LocalLLM: Support for local LLM servers like LM Studio and ollama in OpenAI-compatible mode

## Changes

### Server-side
- Added environment variables for provider configuration in `.env.example`
- Extended `llm.py` to support routing requests to different providers
- Added functions for retrieving and filtering available models
- Added verification endpoint to check provider connections
- Updated `ReportInput` schema to include provider field

### Client-side
- Added provider selection UI in admin panel
- Added provider verification button to test connections
- Updated model selection to dynamically load available models
- Added provider-specific descriptions and error handling

## How to use

1. Set the `LLM_PROVIDER` environment variable to one of: `openai`, `azure`, `openrouter`, or `localllm`
2. Configure provider-specific settings in `.env`:
   - For Open Router: Set `OPENROUTER_API_KEY` and optionally `OPENROUTER_API_BASE`
   - For LocalLLM: Set `LOCALLLM_API_BASE` (default: http://localhost:1234/v1)
3. In the admin UI, select the provider and click "Verify Connection" to test and retrieve available models

## Testing

- Tested with OpenAI provider (default)
- Verified environment variable configuration
- Checked UI for provider selection and verification

Link to Devin run: https://app.devin.ai/sessions/098465449f18450e9295840e58a9620b
Requested by: shinta.nakayama@gmail.com


**コメント:** なし

---

### [管理画面の基本e2eテスト実装の簡素化](https://github.com/digitaldemocracy2030/kouchou-ai/pull/407)

**作成者:** NISHIO Hirokazu+Devin  
**作成日:** 2025-05-01T06:00:01Z  
**変更:** +224 -746 (15ファイル)  
**内容:**

## 概要
Issue #396 に関連する管理画面の基本e2eテスト実装を簡素化しました。

## 変更内容
- 複雑なセレクタ戦略を単純化し、より信頼性の高いセレクタを使用
- h1セレクタをh2セレクタに修正（実際の要素に合わせて）
- introFieldセレクタの問題を修正
- デバッグコードとエラーハンドリングを簡素化
- テストコードの可読性を向上

## テスト方法
```bash
cd test/e2e
npm install
npx playwright install
npx playwright test
```

## 関連Issue/PR
- Issue #396: 管理画面の基本e2eテスト計画
- PR #397: 以前の実装

## Link to Devin run
https://app.devin.ai/sessions/53ea0979f0964bd8bd60bed07ff7fe12

## Requested by
NISHIO Hirokazu (nishio.hirokazu@gmail.com)


**コメント:** なし

---

### [Add environment verification page for ChatGPT API key](https://github.com/digitaldemocracy2030/kouchou-ai/pull/406)

**作成者:** shinta.nakayama+Devin  
**作成日:** 2025-05-01T02:37:40Z  
**変更:** +217 -4 (4ファイル)  
**内容:**

# Add environment verification page for ChatGPT API key

This PR adds a new page in the admin panel for environment verification, specifically to verify the ChatGPT API key. The page allows users to check if their API key is correctly configured.

## Changes
- Added a new API endpoint for verifying the ChatGPT API key using a simple chat request
- Created a new page in the admin panel for environment verification
- Added a link to the environment verification page in the admin dashboard
- Added NEXT_PUBLIC_USE_AZURE to .env.example for client-side access
- Added Japanese error messages for better user experience
- Added special handling for insufficient quota errors (429)

## Testing
- Verified that the API endpoint returns the correct responses for both valid and invalid API keys
- Tested the UI feedback for different verification results
- Confirmed that insufficient quota errors are properly detected and displayed

## Link to Devin run
https://app.devin.ai/sessions/ff39675b8cd54a90a3ea1a54bf82936d

Requested by: shinta.nakayama@gmail.com


**コメント:** なし

---

### [Issue #396: 管理画面の基本e2eテストを実装](https://github.com/digitaldemocracy2030/kouchou-ai/pull/397)

**作成者:** NISHIO Hirokazu+Devin  
**作成日:** 2025-04-30T01:58:00Z  
**変更:** +657 -13 (2ファイル)  
**内容:**

# 管理画面の基本e2eテスト実装

Issue #396 に基づいて、管理画面の基本的なエンドツーエンドテストを実装しました。このテストでは、以下の基本的なワークフローをテストします：

1. 管理画面へのアクセスとログイン（Basic認証）
2. レポート作成ページへの移動
3. 基本情報の入力
4. CSVファイルのアップロード
5. レポート作成の実行と成功確認

## 変更内容
- `test/e2e/tests/admin/create-report.spec.ts` ファイルを更新し、テストを実装
- 既存のページオブジェクトとユーティリティを活用

## テスト方法
テストを実行するには以下のコマンドを使用します：
```
cd test/e2e
npm test
```

Link to Devin run: https://app.devin.ai/sessions/1883f9aaaede4ddab11a25bbbde4d8bc
Requested by: NISHIO Hirokazu (nishio.hirokazu@gmail.com)


**コメント:** なし

---

### 過去7日間に更新されたPR（作成・マージを除く）(0件)

