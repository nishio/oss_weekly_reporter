# GitHub レポート: digitaldemocracy2030/idobata-analyst

期間: 2025-04-09 から 2025-04-16 まで

## Issues

### 過去7日間に完了されたissue (4件)

### [ビジュアル分析タブの余白を調整し、スマホで表示した際にも快適に内容を理解できるようにする](https://github.com/digitaldemocracy2030/idobata-analyst/issues/72)

**作成者:** spinute  
**作成日:** 2025-03-25T07:47:25Z  
**内容:**

## 解決・改善したいこと

<!-- この提案はどのようなものかを説明してください。また、どのような人がどのように嬉しい提案なのかを、できればユーザーを主語にして記載してください。 -->

ビジュアル分析タブをスマホで表示すると、横方向に過度に余白があって見にくい

<!-- 対象画面の URL や関連する議論や資料の URL があれば、添付いただけると理解の助けになります。 -->

![Image](https://github.com/user-attachments/assets/3f9efec6-454b-45d5-919f-20a9d08bb10c)

## 具体的な実現方法・実装方法の概要（未記入でも構いません）

レポートが4重の入れ子 div の中に入っているが、外の3つは不要そう

スマホだと画面幅が狭く特に見づらいが、PC でも無駄なスペースを使っているので、そもそも div の入れ子を減らして良い気がする

**コメント:** なし

---

### [GitHub Actions で test, linter を実行するようにすることで、開発者が安心してコードの品質を高く保てるようにする](https://github.com/digitaldemocracy2030/idobata-analyst/issues/71)

**作成者:** spinute  
**作成日:** 2025-03-23T12:11:05Z  
**内容:**

## 解決・改善したいこと

<!-- この提案はどのようなものかを説明してください。また、どのような人がどのように嬉しい提案なのかを、できればユーザーを主語にして記載してください。 -->

CI で test, linter を実行し、スタイルやコード品質のベースラインをキープできるようにしたい。

<!-- 対象画面の URL や関連する議論や資料の URL があれば、添付いただけると理解の助けになります。 -->

## 具体的な実現方法・実装方法の概要（未記入でも構いません）

- PR に対し、frontend, backend, chat-bot それぞれについて、linter を走らせ、テストを実行する GitHub Actions を定義する

**コメント:** なし

---

### [OpenRouter apiの残りクレジットが少ないときにアラートを出すことで、クレジットが減ってエラーが出やすい状況に気づきやすくする](https://github.com/digitaldemocracy2030/idobata-analyst/issues/22)

**作成者:** blu3mo  
**作成日:** 2025-03-12T06:15:05Z  
**内容:**

OpenRouter、creditの数に比例してquotaが増えていく仕様になっていて、
- 33 creditで元のGCPのquotaと同程度。たまにfailする。
- 常時100 credit以上あれば安心
といった肌感です。

Shutaro Aoyama (Bluemo)
  2分前
クレジットが減ってくると「リクエストが失敗する確率がじわじわ高くなる」という気づきづらい形で影響が出るので、安定して$100以上補充されているようにしたいですね


Shutaro Aoyama (Bluemo)
  たった今
apiで残りクレジット見れそうなのでそれを使ってアラートが出せそう

**コメント:** なし

---

### [コメントの左側のバーの色を、各立場（スタンス）に対応する円グラフの色と一致させることで、読み手が理解しやすくする](https://github.com/digitaldemocracy2030/idobata-analyst/issues/15)

**作成者:** blu3mo  
**作成日:** 2025-03-12T02:08:13Z  
**内容:**

---
• <https://delib.takahiroanno.com/projects/67c7c8cd858bc4c6ea297050/analytics|論点ごとの分析ページ>にて、「円グラフの色」と「コメントの左についているバーの色」を一致させられると見やすそう。
    ◦ 今は「コメントの左についているバーの色」は全部青になっているが、これを「円グラフの色」の青緑橙と一致させたい。
    ◦ フロントエンドだけ触れば対応できる

![Image](https://github.com/user-attachments/assets/b11cf0e2-c381-411a-9fb2-3ff1d56e97b0)

**コメント:** なし

---

### 過去7日間に作成されたissue (0件)

### 過去7日間に更新されたissue（作成・クローズを除く）(9件)

### [プロジェクトレポートの分析に失敗したとき、失敗理由を表示したい](https://github.com/digitaldemocracy2030/idobata-analyst/issues/105)

**作成者:** takker99  
**作成日:** 2025-04-06T06:51:58Z  
**内容:**

## 解決・改善したいこと

「プロジェクトレポートの分析に失敗しました」などと出ますが、理由が示されていなくて戸惑いがちです。

<!-- 対象画面の URL や関連する議論や資料の URL があれば、添付いただけると理解の助けになります。 -->

## 具体的な実現方法・実装方法の概要（未記入でも構いません）

- 失敗理由を出せるなら出したい
  - APIの認証が通らなかった
  - ネットワークがつながらなかった
  - frontend/backendのコードのバグ
  - etc.
- 失敗理由を出せないなら、よくある失敗例みたいなのを出して、開発者のガイドとなるようにしたい

**コメント:** なし

---

### [deep search的な機能によってファクトチェックする](https://github.com/digitaldemocracy2030/idobata-analyst/issues/97)

**作成者:** Ina299  
**作成日:** 2025-04-02T10:05:56Z  
**内容:**

## 解決・改善したいこと

discourse上でファクトを確かめるための機能の実装

**コメント:** なし

---

### [ビジュアル分析をシェアしやすいUIにすることで、良い分析をみた参加者が画像とURLをSNSで共有しやすくする](https://github.com/digitaldemocracy2030/idobata-analyst/issues/81)

**作成者:** itoma-aikon  
**作成日:** 2025-03-27T06:35:38Z  
**内容:**

## 解決・改善したいこと
投稿:314 いいね数5の投稿の分割
- XなどSNSで投稿しやすいように、画像としてダウンロードするボタンを作る:
   - 一定の長さで縦n分割にしてダウンロードするボタンを作るとさらに良さそう

https://large-scale-conversation-sandbox.discourse.group/t/topic/45/50

## 具体的な実現方法・実装方法の概要（未記入でも構いません）


**コメント:** なし

---

### [チャットの履歴を保存できるようにすることで、参加者がより継続的に深く論点に対しての理解を深められるようにする](https://github.com/digitaldemocracy2030/idobata-analyst/issues/77)

**作成者:** itoma-aikon  
**作成日:** 2025-03-27T01:55:47Z  
**内容:**

## 解決・改善したいこと
投稿:mango いいね数3の投稿
チャットでAIと議論してみました。
議論に終わりがないので中断して翌日再開、が出来ると良いと思いました。現状ではブラウザを開いたまま残すしかなさそうです。
マイページ(自分の投稿)から履歴呼び出せるといいですね。
https://large-scale-conversation-sandbox.discourse.group/t/topic/45/30
投稿:mango いいね数0の投稿
一晩経ったら画面の接続が切れ、仕方なく再読み込みしたら会話履歴が消えてしまいました。また1から話すのは辛いです。
https://large-scale-conversation-sandbox.discourse.group/t/topic/45/37
投稿:akinori いいね数2の投稿の分割
ブラウザ操作での再読み込みは禁止する方法があってもいいかもしれないですね。
https://large-scale-conversation-sandbox.discourse.group/t/topic/45/38


## 具体的な実現方法・実装方法の概要（未記入でも構いません）


**コメント:** なし

---

### [バックエンド のテストを導入することで、開発者が継続的にコード品質をキープしやすくする](https://github.com/digitaldemocracy2030/idobata-analyst/issues/70)

**作成者:** spinute  
**作成日:** 2025-03-23T12:06:57Z  
**内容:**

## 解決・改善したいこと

<!-- この提案はどのようなものかを説明してください。また、どのような人がどのように嬉しい提案なのかを、できればユーザーを主語にして記載してください。 -->

/packages/backend のテストがない

<!-- 対象画面の URL や関連する議論や資料の URL があれば、添付いただけると理解の助けになります。 -->

## 具体的な実現方法・実装方法の概要（未記入でも構いません）

jest を使って簡単なテストを導入する

/package/chat-bot には既に導入済みなので、それを参考にすると良いかもしれない

**コメント:** なし

---

### [frontend のテストを導入することで、開発者が継続的にコード品質をキープしやすくする](https://github.com/digitaldemocracy2030/idobata-analyst/issues/69)

**作成者:** spinute  
**作成日:** 2025-03-23T12:06:36Z  
**内容:**

## 解決・改善したいこと

<!-- この提案はどのようなものかを説明してください。また、どのような人がどのように嬉しい提案なのかを、できればユーザーを主語にして記載してください。 -->

/packages/frontend のテストがない

<!-- 対象画面の URL や関連する議論や資料の URL があれば、添付いただけると理解の助けになります。 -->

## 具体的な実現方法・実装方法の概要（未記入でも構いません）

jest を使って簡単なテストを導入する

/package/chat-bot には既に導入済みなので、それを参考にすると良いかもしれない

**コメント:** なし

---

### [論点抽出の仕組みを改善することで、議論に対して的を得ていて、より活発な議論をもたらす論点をAIが抽出できるようにする](https://github.com/digitaldemocracy2030/idobata-analyst/issues/58)

**作成者:** blu3mo  
**作成日:** 2025-03-21T11:23:43Z  
**内容:**

今のパイプラインには2つのステップがある
  - 1 大量の意見から、論点と、各論点における派閥を抽出する
  - 2 各コメントに対して、各論点の派閥をラベル付けする
 **このうち、1（論点抽出）の仕組みを改善したい**

## 現状
  - Geminiに全コメントを放り込んで、雑に論点を5個抽出させている
    - https://github.com/digitaldemocracy2030/idobata-analyst/blob/main/packages/backend/src/config/prompt-templates/question-generation.txt
    - Geminiのコンテキスト幅の長さに甘えている
    - ベースラインとしては良いが、もっと良い方法があると思う

## 目指したい方向
  - 目的：「論点を抽出しつつ各コメントの立場を整理すること」によって、「DiscourseやSNSで①議論が深まり②参加者が増えるようなレポート/エージェントを動作させたい」
    - そのためにできると嬉しいことの例
      - 「マイナーだけど重要な論点」を発見したい
      - 新しい議論を生み出すような論点を発見したい
      - アテンションを集められるような賛否両論がある論点を発見したい
      - 存在する論点を全て網羅したい
      - 他にも色々ありそう
  - その他のnice-to-haveなこと
    - 分析結果の説明可能性が高い
    - コストが低い

## 試してみたいこと
  - 下手にbefore-LLMの手法を参考にするより、LLMを使ったら何ができるかをゼロベースで考えた方が良いものが作れそう
    - よっぽどのことをやらない限り、LLMのコストがボトルネックにはならなさそう。
      - 「全コメントをgemini-2.0-flashに放り込んで立場を分析させる」とか今やっているが全然コストは許容範囲
      - 線形のオーダーのことをやっている限りは大丈夫そう
  - コメントをバッチに分けて論点を生成させた上で最後にまとめた方が細部の論点も拾えそう
    - 例えば、
    - 1: 1000件のコメントを、50件のバッチ20個に分ける
    - 2: 各バッチから5個の論点を抽出する
      - ここは今までと同じようにLLMに全部放り
      - 合計5*20=100個の論点が抽出される。中には似たものも多いと思う。
    - 3: 100個の論点をLLMに放り込んで、渾身の5個の論点を作らせる
    - これは結構さくっと試せそう
  - 「100個の論点を作って、派閥のラベル付けをやって、そのデータを元に論点を5個選ぶ」みたいなやり方もありそう
    - 「100個の論点から5個の論点を選ぶ部分」の仕組みが色々探索できそう
    - n個のコメントがある時に各論点をn次元のベクトルとして捉えて、もっとも直交している五個のベクトルを選ぶ、とか
      - PolisやRemeshが近いアプローチの分析をやっている
        - https://pol.is/
        - https://arxiv.org/html/2503.01769v2
      - これは、分析結果の説明可能性が高い点が良いと思う

## (イシューのスコープ外だが)前提を疑う話
  - 今の「1 論点抽出 → 2 派閥をラベル付け」という設計より良い方法がある？
  - 今の設計の良いところ:
    - 1さえ何とかできれば、2の部分はいくらでもスケール可能
      - 100億件のコメントが来てもこのシステムは同じように動作する
      - コストは線形に伸びていくが、、
    - 新しいコメントが追加された時には2だけやればいいので、低コスト/一瞬でそれを分析結果に組み込める
    - そもそも「論点を抽出してコメントを整理すること」が「DiscourseやSNSで①議論が深まり②参加者が増えるようなレポート/エージェントを作ること」の役にたつのか？

**コメント:** なし

---

### [ビジュアルレポートのタイトルに作成日時が被っているのを改善することで閲覧者が読みやすくする](https://github.com/digitaldemocracy2030/idobata-analyst/issues/57)

**作成者:** nishio  
**作成日:** 2025-03-21T02:25:08Z  
**内容:**

## 解決・改善したいこと

<img width="807" alt="Image" src="https://github.com/user-attachments/assets/b6f050dd-607f-4db4-9e1d-0dd3dec04e7c" />


<!-- 対象画面の URL や関連する議論や資料の URL があれば、添付いただけると理解の助けになります。 -->

## 具体的な実現方法・実装方法の概要（未記入でも構いません）


**コメント:** なし

---

### [extractionフェーズで過度な捨象が発生してしまうのを避けたい](https://github.com/digitaldemocracy2030/idobata-analyst/issues/39)

**作成者:** blu3mo  
**作成日:** 2025-03-17T00:40:13Z  
**内容:**

## 解決・改善したいこと
- extractionフェーズで過度な捨象が発生してしまうのを避けたい。
例：
![Image](https://github.com/user-attachments/assets/30ac4f8d-ba41-4ea6-baec-c57a9114dd7d)
> 安野貴博
  9:28 AM
extractionフェーズで過度に捨象されている例。このぐらいの文量ならまるめなくてもいいようなきがする


## 具体的な実現方法・実装方法の概要（未記入でも構いません）
- プロンプトを修正して過度な捨象を避ける
  - 「適切なextraction」の定義が難しいが、少なくとも現状は捨象しすぎだと思う。特に、主張を抽象化してしまうことで元投稿が言ってないことまでextraction後に書かれてしまうのは望ましくないと思う。

**コメント:** なし

---

## Pull Requests

### 過去7日間にマージされたPR (5件)

### [Run lint and test on push and pull request](https://github.com/digitaldemocracy2030/idobata-analyst/pull/104)

**作成者:** takker99  
**作成日:** 2025-04-06T06:25:53Z  
**変更:** +43 -18 (3ファイル)  
**マージ日:** 2025-04-09T03:31:15Z  
**内容:**

# 変更の概要
- Fix #71

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](/takahiroanno2024/policy-repository/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました


**コメント:** なし

---

### [ディスプレイの大きさに合わせてページ幅を広げるようにした](https://github.com/digitaldemocracy2030/idobata-analyst/pull/102)

**作成者:** spinute  
**作成日:** 2025-04-05T19:01:54Z  
**変更:** +8 -8 (6ファイル)  
**マージ日:** 2025-04-09T03:31:29Z  
**内容:**

# 変更の概要
- 最大コンテンツ幅 4xl で固定されていたが、ディスプレイが大きいときに余白が無駄に広くなってしまうため、ディスプレイ幅の90%を最大コンテンツ幅に定義し直した

before

![Screenshot 2025-04-06 at 4 01 30](https://github.com/user-attachments/assets/b25c33b1-b443-48f8-ba1c-673d94ebcaa3)

after

![Screenshot 2025-04-06 at 4 00 43](https://github.com/user-attachments/assets/a6ca6a32-2843-421c-a021-c1e7cbf7aab6)

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](/takahiroanno2024/policy-repository/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました


**コメント:** なし

---

### [コメントの左側のバーの色を、各立場（スタンス）に対応する円グラフの色と一致させた](https://github.com/digitaldemocracy2030/idobata-analyst/pull/99)

**作成者:** spinute  
**作成日:** 2025-04-04T16:04:33Z  
**変更:** +26 -6 (2ファイル)  
**マージ日:** 2025-04-09T09:18:21Z  
**内容:**

# 変更の概要
- https://github.com/digitaldemocracy2030/idobata-analyst/issues/15 を実装した
- 円グラフ上の色と、コメントに添える色を一致させるようにした
- 「その他」用の色を導入し、「その他」は常にその色になるようにした

![Screenshot 2025-04-05 at 0 59 54](https://github.com/user-attachments/assets/2bfd9cfa-4db2-4124-ac15-02fc528cae8e)

# 変更の背景

- https://github.com/digitaldemocracy2030/idobata-analyst/pull/37 で同 issue に PR を立てていただいていたが、https://github.com/digitaldemocracy2030/idobata-analyst/pull/37#issuecomment-2743121886 が解消されておらず、まだマージできなさそうな状態であった
- 先週の定例の際に状況確認したい旨話が出たので https://github.com/digitaldemocracy2030/idobata-analyst/issues/15#issuecomment-2763375494 や https://w1740803485-clv347541.slack.com/archives/C08FF5MM59C/p1743256551200759 でメンションしてみたものの、お忙しいのか返信いただけていないので、こちらの PR で改めて実装することにした

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](/takahiroanno2024/policy-repository/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました


**コメント:** なし

---

### [ビジュアル分析タブの余白を調整した](https://github.com/digitaldemocracy2030/idobata-analyst/pull/89)

**作成者:** spinute  
**作成日:** 2025-03-29T13:06:55Z  
**変更:** +43 -32 (4ファイル)  
**マージ日:** 2025-04-09T03:33:47Z  
**内容:**

# 変更の概要
- https://github.com/digitaldemocracy2030/idobata-analyst/issues/72 の対応

# 変更の背景
- ビジュアル分析タブにおいて、特にモバイル端末からの閲覧で横幅が狭く、可読性が非常に低かった
- div の階層を減らしたり、余白を減らしたりした
- ビジュアルレポート本体がそもそもモバイル表示厳しそう（おそらく主に①ネストで余白が深くなっていくのと②2カラム表示の2点）なところもあり、それについてはこの PR では対応しない方針とした
    - https://github.com/digitaldemocracy2030/idobata-analyst/issues/96 に切り出した
- TODO: もう少し動作確認してこの PR を review ready にする

before

![Screenshot 2025-03-29 at 22 04 49](https://github.com/user-attachments/assets/e518affc-8bb1-4d54-b643-8214012b20c0)

after

![Screenshot 2025-03-29 at 22 05 11](https://github.com/user-attachments/assets/a4e45c86-3d1c-4401-9bdb-69a461c0eb20)

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](/takahiroanno2024/policy-repository/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました


**コメント:** なし

---

### [OpenRouter のクレジットが少なくなってきたらアラートを表示するようにした](https://github.com/digitaldemocracy2030/idobata-analyst/pull/60)

**作成者:** spinute  
**作成日:** 2025-03-22T13:17:14Z  
**変更:** +123 -4 (5ファイル)  
**マージ日:** 2025-04-09T03:40:10Z  
**内容:**

# 変更の概要
- https://github.com/digitaldemocracy2030/idobata-analyst/issues/22 を途中まで実装した
- https://openrouter.ai/docs/api-reference/get-credits を利用し、残クレジットを取得する
- 残りクレジットを取得し、100クレジットを切ったら console.log
    - アラートは1時間に1回までに制限している
    - 多分最終形は Slack 通知になりそうなので、一旦雑なものを出している
- ↑ の console.log を Slack への send に置き換えたい（が、多分 Slack workspace の適切な権限が必要そうなので一旦ここまで）
    - @blu3mo ここ進め方相談したいです！（webhook URL 発行していただき、環境変数経由で入れる→それを受け取って叩くコードを書いておく等...？）

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](/takahiroanno2024/policy-repository/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました


**コメント:** なし

---

### 過去7日間に作成されたPR (0件)

### 過去7日間に更新されたPR（作成・マージを除く）(1件)

### [コメントの左側のバーの色を、各立場（スタンス）に対応する円グラフの色と一致させることで、読み手が理解しやすくする](https://github.com/digitaldemocracy2030/idobata-analyst/pull/37)

**作成者:** javasparrows  
**作成日:** 2025-03-16T15:03:36Z  
**変更:** +47 -43 (2ファイル)  
**内容:**

# 変更の概要
- コメントの左側のバーの色を各立場（スタンス）に対応する円グラフの色と一致させた

# 変更の背景
- [論点ごとの分析ページにて、グラフとコメントの色をあわせる](https://github.com/takahiroanno2024/idobata-analyst/issues/15)

# CLAへの同意
- 本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](/takahiroanno2024/policy-repository/blob/main/CLA.md)に同意することが必須です。
内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [ x] CLAの内容を読み、同意しました


**コメント:** なし

---

