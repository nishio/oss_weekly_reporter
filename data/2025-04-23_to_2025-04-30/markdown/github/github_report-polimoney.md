# GitHub レポート: digitaldemocracy2030/polimoney

期間: 2025-04-23T18:03:51.976194+09:00 から 2025-04-30T18:03:51.976194+09:00 まで

## Issues

### 過去7日間に完了されたissue (1件)

### [OGPタグを書く](https://github.com/digitaldemocracy2030/polimoney/issues/13)

**作成者:** takahiroanno  
**作成日:** 2025-04-21T12:09:52Z  
**内容:**

- SNSでURLをシェアしたとき、OGPカードとして表示されるようにしたい
  - 画面中央のサンキーダイアグラムが見える
  - 議員の名前が見える

**コメント:** なし

---

### 過去7日間に作成されたissue (7件)

### [devcontainerを設定する](https://github.com/digitaldemocracy2030/polimoney/issues/25)

**作成者:** adust09  
**作成日:** 2025-04-27T04:40:52Z  
**内容:**

# Devcontainerの導入

## 概要
開発環境の統一とセットアップの簡略化のため、devcontainerを導入する

## 目的
- チーム全員が同じ開発環境で作業できるようにする
- 新規開発者のオンボーディングを簡略化する
- CI/CD環境との一貫性を確保する

## タスク
- [ ] `.devcontainer`ディレクトリの作成
- [ ] `devcontainer.json`の設定
  - Node.js 20の環境設定
  - 必要なVS Code拡張機能の設定
  - 自動フォーマットの設定
  - etc
- [ ] `Dockerfile`の作成
- [ ] READMEの作成

**コメント:** なし

---

### [収支報告書のスキーマ定義](https://github.com/digitaldemocracy2030/polimoney/issues/22)

**作成者:** nanocloudx  
**作成日:** 2025-04-25T10:19:13Z  
**内容:**

紙や PDF や Excel で提出されている収支報告書について、実際に手作業で Spreadsheet に転記する作業をしてみました。
（備考１：転記するだけでも心が折れそうになったので、これを作成している秘書の皆様はすげぇな...という気持ちになりました）
（備考２：どう考えても複式簿記にすべきだろ...という気持ちにもなりました、その他に丸め込まれる科目が多すぎる）

その結果、以下のようなラベルを持つ CSV または JSON にできると、取り回ししやすいのではという仮説を持ちました

```
- id
  - 識別番号
  - 収支報告書の大項目、中項目、行番号みたいなのを用いれると識別しやすそう
  - 例：７寄附の内訳 > １個人 > 行番号１ であれば 7-1-1 みたいな
- direction
  - 収入か支出か
  - 大項目2~12がだいたい収入、大項目13以降が支出っぽいです
- category
  - カテゴリー
  - シート左上に大項目みたいなのがある
- subCategory
  - サブカテゴリー
  - シート右上に中項目みたいなのがある
- purpose
  - 目的
  - これは支出にだけ項目がある
- amount
  - 金額
- name
  - 収入元または支出先の名称
- date
  - 日付
  - R5のような表記は西暦に直したほうがフレンドリーと思われる
```

またいくつか注意すべき発見がありました

- 支出＞経常経費＞人件費には内訳の記載がない
- 各大項目の最終ページには「その他の収入」みたいな欄がある(見落としがち)
- 大項目３の内容は大項目１０の内容と重複し、さらに大項目１１に大項目１０の内訳の一部が掲載されている
- 大項目16の内容は他の支出内容の内訳なので重複しうる
- 大項目17以降の内容は一旦無視でも良さそう？（記載のあるケースをまだ見てないので知見が足りない）

<img width="1121" alt="Image" src="https://github.com/user-attachments/assets/7c9a83cf-a0e4-41ac-8d81-505870735b39" />

**コメント:** なし

---

### [支出のどれが税金で賄われているか明示](https://github.com/digitaldemocracy2030/polimoney/issues/21)

**作成者:** shumizu418128  
**作成日:** 2025-04-24T16:30:47Z  
**内容:**

> 国会議員で税金を収入として受け取っている場合、どの使途が税金部分かを明示するのは価値があるのではないかというインプットがありました

[という提案が安野さんに来ていたようです](https://w1740803485-clv347541.slack.com/archives/C08FL5L6GSH/p1745483561743249)のでissueにしておきます。

**コメント:** なし

---

### [収支報告書のフォーマット調査](https://github.com/digitaldemocracy2030/polimoney/issues/20)

**作成者:** shumizu418128  
**作成日:** 2025-04-24T16:28:40Z  
**内容:**

## 背景
政治資金収支報告書は、提出先（各都道府県の選挙管理委員会、総務省）や報告主体（政党、資金管理団体、その他の政治団体など）によってフォーマットが異なることが分かっています。

このフォーマットの多様性は、OCRによる報告書の自動読み取りを進める上で大きな障壁となっています。

## 目的

- **フォーマットの網羅的調査**: 全国の都道府県、国レベルで提出される収支報告書、および団体の種類（政党本部・支部、資金管理団体、その他の政治団体等）によるフォーマットの違いを調査し、実例を収集します。

- **パターン化・分類**: 収集したフォーマットを分析し、共通点、相違点、特有のレイアウトなどを特定し、体系的にパターン化・分類します。

- **課題の理解深化**: 報告書フォーマットの現状を把握することで、データ化における技術的課題や、報告書作成者（政治家側）・利用者（国民側）双方にとっての潜在的な課題（分かりにくさ、比較の難しさ等）への理解を深めます。

- **OCR精度向上の基盤構築**: 特定されたフォーマットパターン情報を、将来的なデータ抽出ロジックの改善に活用します。

## 具体的なタスク

- **情報収集**:
  - 各都道府県の選挙管理委員会、総務省のウェブサイト等を調査し、公開されている政治資金収支報告書のPDFファイルや様式テンプレートを収集します。（例: 「〇〇県 政治資金収支報告書」、「総務省 政治資金収支報告書」等のキーワードで検索）

- **フォーマット分析**:
  - 収集した報告書の構成要素（表紙、収入、支出、資産等の各項目、明細書など）を確認します。
  - レイアウト、記載項目、様式番号（例: 様式その〇〇）の違いを比較・分析します。
  - 特にOCR処理で問題となりそうな箇所（罫線の有無・種類、手書き箇所の多さ、特有の注釈など）に注目します。

※ なんとなくの感想程度で構いません。**ハイレベルな文を書くより、収支報告書とかいう謎文書の手ごわさを理解するほうが大事**だと思います。

- **結果の整理・文書化**:
  - 特定したフォーマットパターンごとに、特徴、出典（都道府県/国、団体種類、年度）、該当する様式のサンプル画像（またはファイルへのリンク）を整理します。

整理した情報は、**[TODO: 記録先未定 提案募集中]** に記録します。

---

めっちゃGeminiに手伝ってもらいましたが、このissueは一応 @shumizu418128 自分で書いています。
本件は私のタスクに直結するので、現時点で本件の主担当は私 @shumizu418128 です。

polimoneyのコンセプトに対する理解への貢献、取り組みやすさの観点から、これはgood first issueになると思います。

**コメント:** なし

---

### [OCR（画像認識）の精度強化](https://github.com/digitaldemocracy2030/polimoney/issues/19)

**作成者:** shumizu418128  
**作成日:** 2025-04-23T14:10:03Z  
**内容:**

ただのメモ
4/23現在、OCR・Geminiまわりの担当は清水のみです
 
### なるべく処理ログを残す
  - どの座標をどんな文字と認識したのか記録
  - 合計金額を計算し記録（「小計」の活用）
  - 手書き文字・訂正印が邪魔で読みにくい部分を記録
  - 備考などのイレギュラー対策の検討
  - 必要に応じて画像をトリミング

目標：バグ発生時の迅速な対応を実現する

### json形式の統一
  - DBとのやりとりはPinさん担当なので相談する
  - 上記処理ログ含め残したい


[参考：4/23 ミーティングログ](https://docs.google.com/document/d/19Kn6ekK3twMVcVaSyUgptvmfzrXEJezA6GXTbPXjm9M/edit?tab=t.0)

**コメント:** なし

---

### [issue templateを用意する](https://github.com/digitaldemocracy2030/polimoney/issues/18)

**作成者:** adust09  
**作成日:** 2025-04-23T13:35:15Z  
**内容:**

**目的**
- 新規参加者(開発者)のオンボーディングコストを下げる
- 多くの開発者間のコミュニケーションコストを下げる

**実装イメージ**
kouchou-aiのテンプレを使えそう
https://github.com/digitaldemocracy2030/kouchou-ai/tree/main/.github/ISSUE_TEMPLATE

**コメント:** なし

---

### [データ引用元のURLを貼る](https://github.com/digitaldemocracy2030/polimoney/issues/17)

**作成者:** adust09  
**作成日:** 2025-04-23T13:31:23Z  
**内容:**

**目的**
- ソースを知りたいユーザーのUXを向上させる
- Polimoney自体の透明性を向上させる

**実装イメージ**
画像のハイライト部分をクリックするとソースに飛ぶようにする
<img width="1031" alt="Image" src="https://github.com/user-attachments/assets/f68044c3-213f-4460-bea2-e26b9226e9f8" />

**参考**
政治資金収支報告書データベースでは似たような機能が実装されている
ex: 
https://political-finance-database.com/politician_detail/1744011775449x224006594647899970

**コメント:** なし

---

### 過去7日間に更新されたissue（作成・クローズを除く）(0件)

## Pull Requests

### 過去7日間にマージされたPR (5件)

### [linterをPR作成時に走らせる設定の追加](https://github.com/digitaldemocracy2030/polimoney/pull/28)

**作成者:** tdaira  
**作成日:** 2025-04-29T23:11:05Z  
**変更:** +55 -0 (1ファイル)  
**マージ日:** 2025-04-30T06:00:02Z  
**内容:**

PR作成時にlintの実行漏れに気付けるるようにGitHub Actionsの設定を行いました。
個人のリポジトリでは問題なく実行されることを確認しています。
https://github.com/tdaira/polimoney/pull/1

こちらのリポジトリでは、maintainerの許可が必要なようです。
<img width="634" alt="スクリーンショット 2025-04-30 8 13 05" src="https://github.com/user-attachments/assets/e25ef1f4-7703-4377-bdb3-78efe8a35a09" />

今後の運用としては、mainに向けたPRマージの前にStatus checkでこの設定のチェックを有効にできると、lint漏れが防げると思います
https://docs.github.com/ja/pull-requests/collaborating-with-pull-requests/collaborating-on-repositories-with-code-quality-features/about-status-checks


**コメント:** なし

---

### [【fix: 13】サンプルデータのOGP Image作成機能実装と反映を行いました](https://github.com/digitaldemocracy2030/polimoney/pull/26)

**作成者:** yuki-snow1823  
**作成日:** 2025-04-27T15:17:51Z  
**変更:** +1045 -1 (9ファイル)  
**マージ日:** 2025-04-28T10:11:07Z  
**内容:**

Fix: #13

## 概要
>SNSでURLをシェアしたとき、OGPカードとして表示されるようにしたい
画面中央のサンキーダイアグラムが見える
議員の名前が見える

SNSでURLをシェアした際のOGPカード表示機能を実装しました。
サンプルデータのOGPのみ反映できる実装になっております。
実際に動的にデータを取得するようになった場合には、改善する必要があります。

## デモ

<img width="1008" alt="ogpimage_list" src="https://github.com/user-attachments/assets/f25f3717-e96d-4091-bf5f-c591bef04fec" />

---

### 確認方法

1. サーバーを起動している状態で`node tools/generate-og-images.js`を実行
2. `public/ogp`配下にsampleデータのOGPが作成されて反映されるようになります

[Localhost Open Graph Debugger](https://og.nullnull.dev/)等のツールでURLを発行し、[OGP確認：facebook、twitter、LINE、はてなのシェア時の画像・文章を表示 | ラッコツールズ🔧](https://rakko.tools/tools/9/)などで確認

## 背景
- Issue #13で指摘された「SNSでシェアした際のOGPカード表示」の要望に対応しました

## 変更内容

### 1. 新規ファイルの追加に関して
- `tools/generate-og-images.js`: OGP画像を生成するスクリプトを追加しました
- `public/ogp/demo-ryosuke-idei-2024.png`: 生成されたOGP画像
- `public/ogp/demo-takahiro-anno-2024.png`: 生成されたOGP画像

### 2. 依存関係の追加
- `puppeteer`: ヘッドレスブラウザを使用してOGP画像を生成するためのライブラリを追加しました

### 3. 実装の詳細
- Puppeteerを使用してヘッドレスブラウザを制御
- 各デモページのグラフ要素を検出してスクリーンショットを撮影
- 背景を透明にして保存

#### 補足
堀越と申します。都内でWEBエンジニアをしております。polimoneyのコンセプトに共感してPRを送らせていただきました。
コントリビュートの説明が見当たらなかったため、突然送る形になって恐縮ですがご確認いただけますと幸いです。

**コメント:** なし

---

### [手書き文字判定の追加](https://github.com/digitaldemocracy2030/polimoney/pull/23)

**作成者:** shumizu418128  
**作成日:** 2025-04-25T15:44:46Z  
**変更:** +15 -7 (1ファイル)  
**マージ日:** 2025-04-28T10:12:11Z  
**内容:**

Geminiで収支報告書の読み取り実験を行ったところ、訂正印付きで訂正された手書き文字の読み取り精度が著しく落ちることが分かっています。
対策として、手書き文字かどうかを判定させることで、この情報を活用して精度を上げることをねらいとしています。

具体的には、手書き文字が出てきた場合には管理画面でアラートを出す、などのアイデアが考えられます。

---

しれっとこのプルリクでプロンプトのjson文法エラーを直しています

**コメント:** なし

---

### [docstring整備](https://github.com/digitaldemocracy2030/polimoney/pull/16)

**作成者:** shumizu418128  
**作成日:** 2025-04-23T03:08:21Z  
**変更:** +22 -5 (1ファイル)  
**マージ日:** 2025-04-28T10:12:36Z  
**内容:**

ドキュメントのみ追加しました。コードの変更はありません。

個人的には詳細な説明は理解の助けになると考えているため、~~もしよければ今後も機能改修と並行してドキュメント作成を進めていきたいと思います。~~ そんな余裕ないかも

なお、`analyze_image_with_gemini` (32行目) については、既存のドキュメントと実際のコード実装に齟齬があったため、正確な内容に修正しています。

**コメント:** なし

---

### [jsonスキーマを採用](https://github.com/digitaldemocracy2030/polimoney/pull/11)

**作成者:** shumizu418128  
**作成日:** 2025-04-20T11:05:13Z  
**変更:** +6 -1 (1ファイル)  
**マージ日:** 2025-04-23T02:10:50Z  
**内容:**

Gemini APIにある、出力をJSONに固定できる機能の実装です。
https://ai.google.dev/gemini-api/docs/structured-output?hl=ja&lang=python

※意図してこれを採用していなかった場合は、このプルリクを消していただいて構いません。

これを採用する場合、
- clean_response (19行目～) がおそらく不要になります。
- まれに出力がjsonにならない（カンマ忘れなど）ことがありますが、数回再試行させるとだいたい直ります。
  - 再試行させるコードを書いてもいいと思います。現状1回問題があると即エラーを出しているようです。
- [出力形式をプロンプトではなくpythonのクラスで指定できます。](https://ai.google.dev/gemini-api/docs/structured-output?hl=ja&lang=python#supply-schema-in-config)プロンプトでも指定可能ですが、こちらのほうがより出力形式が安定します。

**コメント:** なし

---

### 過去7日間に作成されたPR (2件)

### [LinterがGitHub Actions上で走るように設定](https://github.com/digitaldemocracy2030/polimoney/pull/27)

**作成者:** tdaira  
**作成日:** 2025-04-29T22:58:04Z  
**変更:** +55 -0 (1ファイル)  
**内容:**

内容なし

**コメント:** なし

---

### [update readme](https://github.com/digitaldemocracy2030/polimoney/pull/24)

**作成者:** adust09  
**作成日:** 2025-04-27T04:05:02Z  
**変更:** +122 -1 (1ファイル)  
**内容:**

AIに書かせたREADMEであり、一部コマンドは私の方でまだ検証できていません。


**コメント:** なし

---

### 過去7日間に更新されたPR（作成・マージを除く）(0件)

