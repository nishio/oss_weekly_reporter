# GitHub レポート: digitaldemocracy2030/polimoney

期間: 2025-05-18T16:13:46.945931+09:00 から 2025-05-19T16:13:46.945931+09:00 まで

## Issues

### 過去1日間に完了されたissue (1件)

### [総務省ウェブサイトからの政治資金収支報告書PDF自動取得機能](https://github.com/digitaldemocracy2030/polimoney/issues/4)

**作成者:** Olemi-llm-apprentice  
**作成日:** 2025-04-12T07:21:37Z  
**内容:**

**背景:**
政治資金収支報告書の分析には、まず総務省のウェブサイトから対象となる報告書の PDF ファイルを入手する必要があります。現在は、以下のページから手動で目的の団体を探し、PDF をダウンロードする必要があります。

*   参照サイト: [政治資金収支報告書（令和6年11月29日公表（令和5年分定期公表））](https://www.soumu.go.jp/senkyo/seiji_s/seijishikin/reports/SS20241129/)

この手作業は、特に多数の団体を対象とする場合、非常に時間がかかり非効率です。

**課題:**

*   総務省のウェブサイト構造を解析し、目的の団体の報告書 PDF へのリンクを特定する必要がある。
*   ウェブサイトは団体種別（政党本部、政党支部、資金管理団体など）や、あいうえお順のインデックスで構成されており、目的の団体を見つけるために複数のページをナビゲートする必要がある場合がある。
*   手動でのダウンロードは時間と手間がかかる。

**提案:**
総務省のウェブサイトをクローリングし、指定された条件に基づいて政治資金収支報告書の PDF ファイルを自動でダウンロードするスクリプト機能を追加します。

1.  **ウェブスクレイピングの実装:**
    *   Python ライブラリ（例: `requests`, `BeautifulSoup4`）を使用して、上記の総務省のウェブサイトを解析します。
2.  **対象指定機能:**
    *   コマンドライン引数や設定ファイルで、ダウンロード対象とする報告書の公表年、団体種別（政党本部、支部、資金管理団体、その他の政治団体）、特定の団体名などを指定できるようにします。
3.  **リンク探索とダウンロード:**
    *   指定された条件に基づき、ウェブサイトのリンクをたどり、該当する団体の報告書 PDF へのリンクを特定します。
    *   特定したリンクから PDF ファイルをダウンロードし、分かりやすい命名規則（例: `報告年_団体名_種別.pdf`）で指定されたディレクトリに保存します。
4.  **負荷への配慮:**
    *   総務省サーバーへの過度な負荷を避けるため、リクエスト間に適切な待機時間（例: `time.sleep()`）を設けます。また、総務省の `robots.txt` や利用規約を尊重します。

**期待される効果:**
政治資金収支報告書 PDF の収集プロセスが自動化され、分析作業の準備にかかる時間と手間が大幅に削減される。

**担当者:** (任意)
**ラベル:** enhancement, web scraping, data acquisition, automation

**コメント:** なし

---

### 過去1日間に作成されたissue (0件)

### 過去1日間に更新されたissue（作成・クローズを除く）(3件)

### [E2E動作確認（つなぎこみ）](https://github.com/digitaldemocracy2030/polimoney/issues/29)

**作成者:** nanocloudx  
**作成日:** 2025-04-30T13:26:32Z  
**内容:**

精度は悪くても良いので（OCR結果が間違っていることを許容して）、Gemini読み込みからHTML出力までを繋ぎこむ


**コメント:** なし

---

### [収支報告書のフォーマット調査](https://github.com/digitaldemocracy2030/polimoney/issues/20)

**作成者:** shumizu418128  
**作成日:** 2025-04-24T16:28:40Z  
**内容:**

## 背景
政治資金収支報告書は、提出先（各都道府県の選挙管理委員会、総務省）や報告主体（政党、資金管理団体、その他の政治団体など）によってフォーマットが異なることが分かっています。

このフォーマットの多様性は、OCRによる報告書の自動読み取りを進める上で大きな障壁となっています。

## 目的

- **フォーマットの網羅的調査**: 全国の都道府県、国レベルで提出される収支報告書、および団体の種類（政党本部・支部、資金管理団体、その他の政治団体等）によるフォーマットの違いを調査し、実例を収集します。

- **パターン化・分類**: 収集したフォーマットを分析し、共通点、相違点、特有のレイアウトなどを特定し、体系的にパターン化・分類します。

- **課題の理解深化**: 報告書フォーマットの現状を把握することで、データ化における技術的課題や、報告書作成者（政治家側）・利用者（国民側）双方にとっての潜在的な課題（分かりにくさ、比較の難しさ等）への理解を深めます。

- **OCR精度向上の基盤構築**: 特定されたフォーマットパターン情報を、将来的なデータ抽出ロジックの改善に活用します。

## 具体的なタスク

- **情報収集**:
  - 各都道府県の選挙管理委員会、総務省のウェブサイト等を調査し、公開されている政治資金収支報告書のPDFファイルや様式テンプレートを収集します。（例: 「〇〇県 政治資金収支報告書」、「総務省 政治資金収支報告書」等のキーワードで検索）

- **フォーマット分析**:
  - 収集した報告書の構成要素（表紙、収入、支出、資産等の各項目、明細書など）を確認します。
  - レイアウト、記載項目、様式番号（例: 様式その〇〇）の違いを比較・分析します。
  - 特にOCR処理で問題となりそうな箇所（罫線の有無・種類、手書き箇所の多さ、特有の注釈など）に注目します。

※ なんとなくの感想程度で構いません。**ハイレベルな文を書くより、収支報告書とかいう謎文書の手ごわさを理解するほうが大事**だと思います。

- **結果の整理・文書化**:
  - 特定したフォーマットパターンごとに、特徴、出典（都道府県/国、団体種類、年度）、該当する様式のサンプル画像（またはファイルへのリンク）を整理します。

整理した情報は、**[TODO: 記録先未定 提案募集中]** に記録します。

---

めっちゃGeminiに手伝ってもらいましたが、このissueは一応 @shumizu418128 自分で書いています。
本件は私のタスクに直結するので、現時点で本件の主担当は私 @shumizu418128 です。

polimoneyのコンセプトに対する理解への貢献、取り組みやすさの観点から、これはgood first issueになると思います。

**コメント:** なし

---

### [OCR（画像認識）の精度強化](https://github.com/digitaldemocracy2030/polimoney/issues/19)

**作成者:** shumizu418128  
**作成日:** 2025-04-23T14:10:03Z  
**内容:**

ただのメモ
4/23現在、OCR・Geminiまわりの担当は清水のみです
 
### なるべく処理ログを残す
  - どの座標をどんな文字と認識したのか記録
  - 合計金額を計算し記録（「小計」の活用）
  - 手書き文字・訂正印が邪魔で読みにくい部分を記録
  - 備考などのイレギュラー対策の検討
  - 必要に応じて画像をトリミング

目標：バグ発生時の迅速な対応を実現する

### json形式の統一
  - DBとのやりとりはPinさん担当なので相談する
  - 上記処理ログ含め残したい


[参考：4/23 ミーティングログ](https://docs.google.com/document/d/19Kn6ekK3twMVcVaSyUgptvmfzrXEJezA6GXTbPXjm9M/edit?tab=t.0)

**コメント:** なし

---

## Pull Requests

### 過去1日間にマージされたPR (2件)

### [一時的なOGP画像を設定](https://github.com/digitaldemocracy2030/polimoney/pull/67)

**作成者:** dotneet  
**作成日:** 2025-05-19T04:18:51Z  
**変更:** +3 -0 (2ファイル)  
**マージ日:** 2025-05-19T07:05:02Z  
**内容:**

# 変更の概要

 - 一時的なOGP画像を設定(正式なものではありません)

# スクリーンショット
<!-- UIの変更を伴う場合は、変更前後のスクリーンショットもしくはgif画像をこちらに記載してください -->

# 変更の背景
<!-- ここに変更が必要となった背景を記載してください -->


# 関連Issue
<!-- 関連するIssueのリンクをこちらに記載してください -->

 - #46 

# CLAへの同意
本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/idobata/blob/main/CLA.md)に同意することが必須です。

内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました


<!-- This is an auto-generated comment: release notes by coderabbit.ai -->

## Summary by CodeRabbit

- **新機能**
  - ページのOpen Graph情報に画像が追加され、SNS等でのシェア時にサムネイル画像が表示されるようになりました。

<!-- end of auto-generated comment: release notes by coderabbit.ai -->

**コメント:** なし

---

### [E2E - Geminiプロンプト新設](https://github.com/digitaldemocracy2030/polimoney/pull/66)

**作成者:** shumizu418128  
**作成日:** 2025-05-18T08:52:38Z  
**変更:** +83 -20 (3ファイル)  
**マージ日:** 2025-05-18T08:52:46Z  
**内容:**

# 変更の概要
1. 該当年度の取得をするため、表紙に対して専用プロンプトの新設
2. 複数ページに対して個別にgeminiにid付与をさせていた影響で、idの重複が発生していた問題の修正

なお、表紙からとるべき情報はまだあるので、まだ改善が必要です。

# 変更の背景
E2E実現に向けた問題の修正です。
なお、Geminiの精度のおかげでだいぶいい感じのデータが出せるようになりましたが、収入と支出の合計値が合わず、これだけではまだエラーが出る状況です。

[出力のall.json](https://github.com/user-attachments/files/20271928/all.json)

# 関連Issue
#29 

# CLAへの同意
本リポジトリへのコントリビュートには、[コントリビューターライセンス契約（CLA）](https://github.com/digitaldemocracy2030/idobata/blob/main/CLA.md)に同意することが必須です。

内容をお読みいただき、下記のチェックボックスにチェックをつける（"- [ ]" を "- [x]" に書き換える）ことで同意したものとみなします。

- [x] CLAの内容を読み、同意しました


<!-- This is an auto-generated comment: release notes by coderabbit.ai -->

## Summary by CodeRabbit

- **新機能**
  - 画像ファイル名からページ番号を判別し、1ページ目専用のプロンプトを用いて年を抽出する機能を追加しました。

- **ドキュメント**
  - JSONデータのID付与ルールや例を明確化し、IDの一貫性に関する説明を改善しました。
  - 年度抽出用プロンプトの説明と例を追加しました。
  - 関数の説明ドキュメントを追加しました。

- **バグ修正**
  - JSONマージ時、カテゴリや取引名の先頭の数字・記号を正規表現で除去し、正しく正規化されるように改善しました。
  - 年度の決定方法を修正し、最初のファイルから取得するようにしました。
  - カテゴリや取引が存在しない場合でも安全にマージできるように修正しました。

<!-- end of auto-generated comment: release notes by coderabbit.ai -->

**コメント:** なし

---

### 過去1日間に作成されたPR (0件)

### 過去1日間に更新されたPR（作成・マージを除く）(1件)

### [E2Eテストで発生したエラーの修正](https://github.com/digitaldemocracy2030/polimoney/pull/35)

**作成者:** shumizu418128  
**作成日:** 2025-04-30T15:25:31Z  
**変更:** +26 -5 (1ファイル)  
**内容:**

https://github.com/digitaldemocracy2030/polimoney/issues/29#issuecomment-2842261513

ここで発生したエラーのうち、直さないと実行不可能なものをすべて修正しています

**diffがすごいことになっていますが、merge_jsons.py以外すべてpopplerの新規追加です**

popplerが無いとpdf2imageが動作できない
UnicodeDecodeError: 'cp932' codec can't decode byte 0x8d in position 96: illegal multibyte sequence
→原因：utf-8指定忘れ
TypeError: list indices must be integers or slices, not str
→原因：data["item"]が直接リストになっている
ValueError: No objects to concatenate
→原因：target_dirの定義が甘い
OSError: Cannot save file into a non-existent directory: 'merged_files'
→原因：保存先のフォルダ名にtoolsが入っていない

なお、typeerrorのみjsonの出力を正しく設定すれば直る可能性があり、その場合は`tools\merge_jsons.py`11行目を元に戻す必要があります

**コメント:** なし

---

